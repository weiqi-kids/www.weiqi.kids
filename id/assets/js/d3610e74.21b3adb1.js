"use strict";(self.webpackChunktemp_docusaurus=self.webpackChunktemp_docusaurus||[]).push([[6843],{5024:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>l,toc:()=>a});const l=JSON.parse('{"id":"for-engineers/deep-dive/training","title":"\u8a13\u7df4\u81ea\u5df1\u7684\u6a21\u578b","description":"\u5f9e\u96f6\u958b\u59cb\u8a13\u7df4\u570d\u68cb AI \u6a21\u578b\u7684\u5b8c\u6574\u6307\u5357","source":"@site/docs/for-engineers/deep-dive/training.md","sourceDirName":"for-engineers/deep-dive","slug":"/for-engineers/deep-dive/training","permalink":"/id/docs/for-engineers/deep-dive/training","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/for-engineers/deep-dive/training.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"\u8a13\u7df4\u81ea\u5df1\u7684\u6a21\u578b","description":"\u5f9e\u96f6\u958b\u59cb\u8a13\u7df4\u570d\u68cb AI \u6a21\u578b\u7684\u5b8c\u6574\u6307\u5357"},"sidebar":"tutorialSidebar","previous":{"title":"KataGo \u539f\u59cb\u78bc\u5c0e\u8b80","permalink":"/id/docs/for-engineers/deep-dive/source-code"},"next":{"title":"\u53c3\u8207\u958b\u6e90\u793e\u7fa4","permalink":"/id/docs/for-engineers/deep-dive/contributing"}}');var r=s(3420),i=s(5521);const d={sidebar_position:3,title:"\u8a13\u7df4\u81ea\u5df1\u7684\u6a21\u578b",description:"\u5f9e\u96f6\u958b\u59cb\u8a13\u7df4\u570d\u68cb AI \u6a21\u578b\u7684\u5b8c\u6574\u6307\u5357"},t="\u8a13\u7df4\u81ea\u5df1\u7684\u6a21\u578b",c={},a=[{value:"\u8a13\u7df4\u6982\u8ff0",id:"\u8a13\u7df4\u6982\u8ff0",level:2},{value:"\u8a13\u7df4\u5faa\u74b0",id:"\u8a13\u7df4\u5faa\u74b0",level:3},{value:"\u786c\u9ad4\u9700\u6c42",id:"\u786c\u9ad4\u9700\u6c42",level:3},{value:"\u74b0\u5883\u8a2d\u5b9a",id:"\u74b0\u5883\u8a2d\u5b9a",level:2},{value:"\u5b89\u88dd\u4f9d\u8cf4",id:"\u5b89\u88dd\u4f9d\u8cf4",level:3},{value:"\u53d6\u5f97\u8a13\u7df4\u7a0b\u5f0f\u78bc",id:"\u53d6\u5f97\u8a13\u7df4\u7a0b\u5f0f\u78bc",level:3},{value:"\u8a13\u7df4\u8a2d\u5b9a",id:"\u8a13\u7df4\u8a2d\u5b9a",level:2},{value:"\u8a2d\u5b9a\u6a94\u7d50\u69cb",id:"\u8a2d\u5b9a\u6a94\u7d50\u69cb",level:3},{value:"\u6a21\u578b\u898f\u6a21\u5c0d\u7167",id:"\u6a21\u578b\u898f\u6a21\u5c0d\u7167",level:3},{value:"\u8a13\u7df4\u6d41\u7a0b",id:"\u8a13\u7df4\u6d41\u7a0b",level:2},{value:"\u6b65\u9a5f 1\uff1a\u521d\u59cb\u5316\u6a21\u578b",id:"\u6b65\u9a5f-1\u521d\u59cb\u5316\u6a21\u578b",level:3},{value:"\u6b65\u9a5f 2\uff1a\u81ea\u6211\u5c0d\u5f08\u7522\u751f\u8cc7\u6599",id:"\u6b65\u9a5f-2\u81ea\u6211\u5c0d\u5f08\u7522\u751f\u8cc7\u6599",level:3},{value:"\u6b65\u9a5f 3\uff1a\u8a13\u7df4\u795e\u7d93\u7db2\u8def",id:"\u6b65\u9a5f-3\u8a13\u7df4\u795e\u7d93\u7db2\u8def",level:3},{value:"\u6b65\u9a5f 4\uff1a\u8a55\u4f30\u8207\u8fed\u4ee3",id:"\u6b65\u9a5f-4\u8a55\u4f30\u8207\u8fed\u4ee3",level:3},{value:"\u640d\u5931\u51fd\u6578\u8a73\u89e3",id:"\u640d\u5931\u51fd\u6578\u8a73\u89e3",level:2},{value:"Policy Loss",id:"policy-loss",level:3},{value:"Value Loss",id:"value-loss",level:3},{value:"Ownership Loss",id:"ownership-loss",level:3},{value:"\u9032\u968e\u6280\u5de7",id:"\u9032\u968e\u6280\u5de7",level:2},{value:"1. \u8cc7\u6599\u589e\u5f37",id:"1-\u8cc7\u6599\u589e\u5f37",level:3},{value:"2. \u8ab2\u7a0b\u5b78\u7fd2",id:"2-\u8ab2\u7a0b\u5b78\u7fd2",level:3},{value:"3. \u6df7\u5408\u7cbe\u5ea6\u8a13\u7df4",id:"3-\u6df7\u5408\u7cbe\u5ea6\u8a13\u7df4",level:3},{value:"4. \u591a GPU \u8a13\u7df4",id:"4-\u591a-gpu-\u8a13\u7df4",level:3},{value:"\u76e3\u63a7\u8207\u9664\u932f",id:"\u76e3\u63a7\u8207\u9664\u932f",level:2},{value:"TensorBoard \u76e3\u63a7",id:"tensorboard-\u76e3\u63a7",level:3},{value:"\u5e38\u898b\u554f\u984c",id:"\u5e38\u898b\u554f\u984c",level:3},{value:"\u5c0f\u898f\u6a21\u5be6\u9a57\u5efa\u8b70",id:"\u5c0f\u898f\u6a21\u5be6\u9a57\u5efa\u8b70",level:2},{value:"\u5ef6\u4f38\u95b1\u8b80",id:"\u5ef6\u4f38\u95b1\u8b80",level:2}];function o(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"\u8a13\u7df4\u81ea\u5df1\u7684\u6a21\u578b",children:"\u8a13\u7df4\u81ea\u5df1\u7684\u6a21\u578b"})}),"\n",(0,r.jsx)(e.p,{children:"\u672c\u6587\u4ecb\u7d39\u5982\u4f55\u5f9e\u96f6\u958b\u59cb\u8a13\u7df4\u81ea\u5df1\u7684\u570d\u68cb AI \u6a21\u578b\u3002"}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u8a13\u7df4\u6982\u8ff0",children:"\u8a13\u7df4\u6982\u8ff0"}),"\n",(0,r.jsx)(e.h3,{id:"\u8a13\u7df4\u5faa\u74b0",children:"\u8a13\u7df4\u5faa\u74b0"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"\u521d\u59cb\u6a21\u578b \u2192 \u81ea\u6211\u5c0d\u5f08 \u2192 \u6536\u96c6\u8cc7\u6599 \u2192 \u8a13\u7df4\u66f4\u65b0 \u2192 \u66f4\u5f37\u6a21\u578b \u2192 \u91cd\u8907\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52d5\u756b\u5c0d\u61c9"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac E5 \u81ea\u6211\u5c0d\u5f08 \u2194 \u4e0d\u52d5\u9ede\u6536\u6582"}),"\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac E6 \u68cb\u529b\u66f2\u7dda \u2194 S \u66f2\u7dda\u6210\u9577"}),"\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac H1 MDP \u2194 \u99ac\u53ef\u592b\u93c8"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u786c\u9ad4\u9700\u6c42",children:"\u786c\u9ad4\u9700\u6c42"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u6a21\u578b\u898f\u6a21"}),(0,r.jsx)(e.th,{children:"GPU \u8a18\u61b6\u9ad4"}),(0,r.jsx)(e.th,{children:"\u8a13\u7df4\u6642\u9593"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b6c96"}),(0,r.jsx)(e.td,{children:"4 GB"}),(0,r.jsx)(e.td,{children:"\u6578\u5c0f\u6642"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b10c128"}),(0,r.jsx)(e.td,{children:"8 GB"}),(0,r.jsx)(e.td,{children:"1-2 \u5929"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b18c384"}),(0,r.jsx)(e.td,{children:"16 GB"}),(0,r.jsx)(e.td,{children:"1-2 \u9031"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b40c256"}),(0,r.jsx)(e.td,{children:"24 GB+"}),(0,r.jsx)(e.td,{children:"\u6578\u9031"})]})]})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u74b0\u5883\u8a2d\u5b9a",children:"\u74b0\u5883\u8a2d\u5b9a"}),"\n",(0,r.jsx)(e.h3,{id:"\u5b89\u88dd\u4f9d\u8cf4",children:"\u5b89\u88dd\u4f9d\u8cf4"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# Python \u74b0\u5883\nconda create -n katago python=3.10\nconda activate katago\n\n# PyTorch\uff08CUDA \u7248\u672c\uff09\npip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118\n\n# \u5176\u4ed6\u4f9d\u8cf4\npip install numpy h5py tqdm tensorboard\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u53d6\u5f97\u8a13\u7df4\u7a0b\u5f0f\u78bc",children:"\u53d6\u5f97\u8a13\u7df4\u7a0b\u5f0f\u78bc"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"git clone https://github.com/lightvector/KataGo.git\ncd KataGo/python\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u8a13\u7df4\u8a2d\u5b9a",children:"\u8a13\u7df4\u8a2d\u5b9a"}),"\n",(0,r.jsx)(e.h3,{id:"\u8a2d\u5b9a\u6a94\u7d50\u69cb",children:"\u8a2d\u5b9a\u6a94\u7d50\u69cb"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'# configs/train_config.yaml\n\n# \u6a21\u578b\u67b6\u69cb\nmodel:\n  num_blocks: 10          # \u6b98\u5dee\u584a\u6578\u91cf\n  trunk_channels: 128     # \u4e3b\u5e79\u901a\u9053\u6578\n  policy_channels: 32     # Policy \u982d\u901a\u9053\u6578\n  value_channels: 32      # Value \u982d\u901a\u9053\u6578\n\n# \u8a13\u7df4\u53c3\u6578\ntraining:\n  batch_size: 256\n  learning_rate: 0.001\n  lr_schedule: "cosine"\n  weight_decay: 0.0001\n  epochs: 100\n\n# \u81ea\u6211\u5c0d\u5f08\u53c3\u6578\nselfplay:\n  num_games_per_iteration: 1000\n  max_visits: 600\n  temperature: 1.0\n  temperature_drop_move: 20\n\n# \u8cc7\u6599\u8a2d\u5b9a\ndata:\n  max_history_games: 500000\n  shuffle_buffer_size: 100000\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u6a21\u578b\u898f\u6a21\u5c0d\u7167",children:"\u6a21\u578b\u898f\u6a21\u5c0d\u7167"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u540d\u7a31"}),(0,r.jsx)(e.th,{children:"num_blocks"}),(0,r.jsx)(e.th,{children:"trunk_channels"}),(0,r.jsx)(e.th,{children:"\u53c3\u6578\u91cf"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b6c96"}),(0,r.jsx)(e.td,{children:"6"}),(0,r.jsx)(e.td,{children:"96"}),(0,r.jsx)(e.td,{children:"~1M"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b10c128"}),(0,r.jsx)(e.td,{children:"10"}),(0,r.jsx)(e.td,{children:"128"}),(0,r.jsx)(e.td,{children:"~3M"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b18c384"}),(0,r.jsx)(e.td,{children:"18"}),(0,r.jsx)(e.td,{children:"384"}),(0,r.jsx)(e.td,{children:"~20M"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b40c256"}),(0,r.jsx)(e.td,{children:"40"}),(0,r.jsx)(e.td,{children:"256"}),(0,r.jsx)(e.td,{children:"~45M"})]})]})]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52d5\u756b\u5c0d\u61c9"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac F2 \u7db2\u8def\u5927\u5c0f vs \u68cb\u529b\uff1a\u5bb9\u91cf\u7e2e\u653e"}),"\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac F6 \u795e\u7d93\u7e2e\u653e\u5f8b\uff1a\u96d9\u5c0d\u6578\u95dc\u4fc2"}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u8a13\u7df4\u6d41\u7a0b",children:"\u8a13\u7df4\u6d41\u7a0b"}),"\n",(0,r.jsx)(e.h3,{id:"\u6b65\u9a5f-1\u521d\u59cb\u5316\u6a21\u578b",children:"\u6b65\u9a5f 1\uff1a\u521d\u59cb\u5316\u6a21\u578b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# init_model.py\nimport torch\nfrom model import KataGoModel\n\nconfig = {\n    'num_blocks': 10,\n    'trunk_channels': 128,\n    'input_features': 22,\n    'policy_size': 362,  # 361 + pass\n}\n\nmodel = KataGoModel(config)\ntorch.save(model.state_dict(), 'model_init.pt')\nprint(f\"\u6a21\u578b\u53c3\u6578\u91cf: {sum(p.numel() for p in model.parameters()):,}\")\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u6b65\u9a5f-2\u81ea\u6211\u5c0d\u5f08\u7522\u751f\u8cc7\u6599",children:"\u6b65\u9a5f 2\uff1a\u81ea\u6211\u5c0d\u5f08\u7522\u751f\u8cc7\u6599"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u7de8\u8b6f C++ \u5f15\u64ce\ncd ../cpp\nmkdir build && cd build\ncmake .. -DUSE_BACKEND=CUDA\nmake -j$(nproc)\n\n# \u57f7\u884c\u81ea\u6211\u5c0d\u5f08\n./katago selfplay \\\n  -model ../python/model_init.pt \\\n  -output-dir ../python/selfplay_data \\\n  -config selfplay.cfg \\\n  -num-games 1000\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u81ea\u6211\u5c0d\u5f08\u8a2d\u5b9a\uff08selfplay.cfg\uff09\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ini",children:"maxVisits = 600\nnumSearchThreads = 4\n\n# \u6eab\u5ea6\u8a2d\u5b9a\uff08\u589e\u52a0\u63a2\u7d22\uff09\nchosenMoveTemperature = 1.0\nchosenMoveTemperatureEarly = 1.0\nchosenMoveTemperatureHalflife = 20\n\n# Dirichlet \u566a\u8072\uff08\u589e\u52a0\u591a\u6a23\u6027\uff09\nrootNoiseEnabled = true\nrootDirichletNoiseTotalConcentration = 10.83\nrootDirichletNoiseWeight = 0.25\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52d5\u756b\u5c0d\u61c9"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac C3 \u63a2\u7d22 vs \u5229\u7528\uff1a\u6eab\u5ea6\u53c3\u6578"}),"\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac E10 Dirichlet \u566a\u8072\uff1a\u6839\u7bc0\u9ede\u63a2\u7d22"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u6b65\u9a5f-3\u8a13\u7df4\u795e\u7d93\u7db2\u8def",children:"\u6b65\u9a5f 3\uff1a\u8a13\u7df4\u795e\u7d93\u7db2\u8def"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# train.py\nimport torch\nfrom torch.utils.data import DataLoader\nfrom model import KataGoModel\nfrom dataset import SelfPlayDataset\n\n# \u8f09\u5165\u8cc7\u6599\ndataset = SelfPlayDataset('selfplay_data/')\ndataloader = DataLoader(dataset, batch_size=256, shuffle=True)\n\n# \u8f09\u5165\u6a21\u578b\nmodel = KataGoModel(config)\nmodel.load_state_dict(torch.load('model_init.pt'))\nmodel = model.cuda()\n\n# \u512a\u5316\u5668\noptimizer = torch.optim.Adam(\n    model.parameters(),\n    lr=0.001,\n    weight_decay=0.0001\n)\n\n# \u5b78\u7fd2\u7387\u6392\u7a0b\nscheduler = torch.optim.lr_scheduler.CosineAnnealingLR(\n    optimizer,\n    T_max=100,\n    eta_min=0.00001\n)\n\n# \u8a13\u7df4\u5faa\u74b0\nfor epoch in range(100):\n    model.train()\n    total_loss = 0\n\n    for batch in dataloader:\n        inputs = batch['inputs'].cuda()\n        policy_target = batch['policy'].cuda()\n        value_target = batch['value'].cuda()\n        ownership_target = batch['ownership'].cuda()\n\n        # \u524d\u5411\u50b3\u64ad\n        policy_pred, value_pred, ownership_pred = model(inputs)\n\n        # \u8a08\u7b97\u640d\u5931\n        policy_loss = torch.nn.functional.cross_entropy(\n            policy_pred, policy_target\n        )\n        value_loss = torch.nn.functional.mse_loss(\n            value_pred, value_target\n        )\n        ownership_loss = torch.nn.functional.mse_loss(\n            ownership_pred, ownership_target\n        )\n\n        loss = policy_loss + value_loss + 0.5 * ownership_loss\n\n        # \u53cd\u5411\u50b3\u64ad\n        optimizer.zero_grad()\n        loss.backward()\n        torch.nn.utils.clip_grad_norm_(model.parameters(), 1.0)\n        optimizer.step()\n\n        total_loss += loss.item()\n\n    scheduler.step()\n    print(f\"Epoch {epoch}: Loss = {total_loss / len(dataloader):.4f}\")\n\n    # \u5132\u5b58\u6aa2\u67e5\u9ede\n    torch.save(model.state_dict(), f'model_epoch{epoch}.pt')\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52d5\u756b\u5c0d\u61c9"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac D5 \u68af\u5ea6\u4e0b\u964d\uff1aoptimizer.step()"}),"\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac K2 \u52d5\u91cf\uff1aAdam \u512a\u5316\u5668"}),"\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac K4 \u5b78\u7fd2\u7387\u8870\u6e1b\uff1aCosineAnnealingLR"}),"\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac K5 \u68af\u5ea6\u88c1\u526a\uff1aclip_grad_norm_"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u6b65\u9a5f-4\u8a55\u4f30\u8207\u8fed\u4ee3",children:"\u6b65\u9a5f 4\uff1a\u8a55\u4f30\u8207\u8fed\u4ee3"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u8a55\u4f30\u65b0\u6a21\u578b vs \u820a\u6a21\u578b\n./katago match \\\n  -model1 model_epoch99.pt \\\n  -model2 model_init.pt \\\n  -num-games 100 \\\n  -output match_results.txt\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679c\u65b0\u6a21\u578b\u52dd\u7387 > 55%\uff0c\u5247\u53d6\u4ee3\u820a\u6a21\u578b\uff0c\u9032\u5165\u4e0b\u4e00\u8f2a\u8fed\u4ee3\u3002"}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u640d\u5931\u51fd\u6578\u8a73\u89e3",children:"\u640d\u5931\u51fd\u6578\u8a73\u89e3"}),"\n",(0,r.jsx)(e.h3,{id:"policy-loss",children:"Policy Loss"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# \u4ea4\u53c9\u71b5\u640d\u5931\npolicy_loss = -sum(target * log(pred))\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u76ee\u6a19\uff1a\u8b93\u9810\u6e2c\u7684\u6a5f\u7387\u5206\u5e03\u63a5\u8fd1 MCTS \u641c\u7d22\u7d50\u679c\u3002"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52d5\u756b\u5c0d\u61c9"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac J1 \u7b56\u7565\u71b5\uff1a\u4ea4\u53c9\u71b5"}),"\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac J2 KL \u6563\u5ea6\uff1a\u5206\u5e03\u8ddd\u96e2"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"value-loss",children:"Value Loss"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# \u5747\u65b9\u8aa4\u5dee\nvalue_loss = (pred - actual_result)^2\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u76ee\u6a19\uff1a\u9810\u6e2c\u5c0d\u5c40\u6700\u7d42\u7d50\u679c\uff08\u52dd/\u8ca0/\u548c\uff09\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"ownership-loss",children:"Ownership Loss"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# \u6bcf\u9ede\u6b78\u5c6c\u9810\u6e2c\nownership_loss = mean((pred - actual_ownership)^2)\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u76ee\u6a19\uff1a\u9810\u6e2c\u6bcf\u500b\u4f4d\u7f6e\u6700\u7d42\u6b78\u5c6c\u3002"}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u9032\u968e\u6280\u5de7",children:"\u9032\u968e\u6280\u5de7"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u8cc7\u6599\u589e\u5f37",children:"1. \u8cc7\u6599\u589e\u5f37"}),"\n",(0,r.jsx)(e.p,{children:"\u5229\u7528\u68cb\u76e4\u7684\u5c0d\u7a31\u6027\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'def augment_data(board, policy, ownership):\n    """\u5c0d D4 \u7fa4\u7684 8 \u7a2e\u8b8a\u63db\u9032\u884c\u8cc7\u6599\u589e\u5f37"""\n    augmented = []\n\n    for rotation in range(4):\n        for flip in [False, True]:\n            # \u65cb\u8f49\u8207\u7ffb\u8f49\n            aug_board = transform(board, rotation, flip)\n            aug_policy = transform(policy, rotation, flip)\n            aug_ownership = transform(ownership, rotation, flip)\n            augmented.append((aug_board, aug_policy, aug_ownership))\n\n    return augmented\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52d5\u756b\u5c0d\u61c9"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac A9 \u68cb\u76e4\u5c0d\u7a31\u6027\uff1aD4 \u7fa4"}),"\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac L4 \u8cc7\u6599\u589e\u5f37\uff1a\u5c0d\u7a31\u6027\u5229\u7528"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"2-\u8ab2\u7a0b\u5b78\u7fd2",children:"2. \u8ab2\u7a0b\u5b78\u7fd2"}),"\n",(0,r.jsx)(e.p,{children:"\u5f9e\u7c21\u55ae\u5230\u8907\u96dc\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# \u5148\u7528\u8f03\u5c11\u641c\u7d22\u6b21\u6578\u8a13\u7df4\nschedule = [\n    (100, 10000),   # 100 visits, 10000 games\n    (200, 20000),   # 200 visits, 20000 games\n    (400, 50000),   # 400 visits, 50000 games\n    (600, 100000),  # 600 visits, 100000 games\n]\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52d5\u756b\u5c0d\u61c9"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac E12 \u8a13\u7df4\u8ab2\u7a0b\uff1a\u8ab2\u7a0b\u5b78\u7fd2"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"3-\u6df7\u5408\u7cbe\u5ea6\u8a13\u7df4",children:"3. \u6df7\u5408\u7cbe\u5ea6\u8a13\u7df4"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"from torch.cuda.amp import autocast, GradScaler\n\nscaler = GradScaler()\n\nwith autocast():\n    policy_pred, value_pred, ownership_pred = model(inputs)\n    loss = compute_loss(...)\n\nscaler.scale(loss).backward()\nscaler.step(optimizer)\nscaler.update()\n"})}),"\n",(0,r.jsx)(e.h3,{id:"4-\u591a-gpu-\u8a13\u7df4",children:"4. \u591a GPU \u8a13\u7df4"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"import torch.distributed as dist\nfrom torch.nn.parallel import DistributedDataParallel\n\n# \u521d\u59cb\u5316\u5206\u6563\u5f0f\ndist.init_process_group(backend='nccl')\n\n# \u5305\u88dd\u6a21\u578b\nmodel = DistributedDataParallel(model)\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u76e3\u63a7\u8207\u9664\u932f",children:"\u76e3\u63a7\u8207\u9664\u932f"}),"\n",(0,r.jsx)(e.h3,{id:"tensorboard-\u76e3\u63a7",children:"TensorBoard \u76e3\u63a7"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"from torch.utils.tensorboard import SummaryWriter\n\nwriter = SummaryWriter('runs/training')\n\n# \u8a18\u9304\u640d\u5931\nwriter.add_scalar('Loss/policy', policy_loss, step)\nwriter.add_scalar('Loss/value', value_loss, step)\nwriter.add_scalar('Loss/total', total_loss, step)\n\n# \u8a18\u9304\u5b78\u7fd2\u7387\nwriter.add_scalar('LR', scheduler.get_last_lr()[0], step)\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"tensorboard --logdir runs\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u5e38\u898b\u554f\u984c",children:"\u5e38\u898b\u554f\u984c"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u554f\u984c"}),(0,r.jsx)(e.th,{children:"\u53ef\u80fd\u539f\u56e0"}),(0,r.jsx)(e.th,{children:"\u89e3\u6c7a\u65b9\u6848"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u640d\u5931\u4e0d\u4e0b\u964d"}),(0,r.jsx)(e.td,{children:"\u5b78\u7fd2\u7387\u592a\u4f4e/\u592a\u9ad8"}),(0,r.jsx)(e.td,{children:"\u8abf\u6574\u5b78\u7fd2\u7387"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u640d\u5931\u9707\u76ea"}),(0,r.jsx)(e.td,{children:"\u6279\u6b21\u5927\u5c0f\u592a\u5c0f"}),(0,r.jsx)(e.td,{children:"\u589e\u52a0\u6279\u6b21\u5927\u5c0f"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u904e\u64ec\u5408"}),(0,r.jsx)(e.td,{children:"\u8cc7\u6599\u4e0d\u8db3"}),(0,r.jsx)(e.td,{children:"\u7522\u751f\u66f4\u591a\u81ea\u6211\u5c0d\u5f08\u8cc7\u6599"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u68cb\u529b\u4e0d\u589e\u9577"}),(0,r.jsx)(e.td,{children:"\u641c\u7d22\u6b21\u6578\u592a\u5c11"}),(0,r.jsx)(e.td,{children:"\u589e\u52a0 maxVisits"})]})]})]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52d5\u756b\u5c0d\u61c9"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac L1 \u904e\u64ec\u5408\uff1a\u904e\u5ea6\u9069\u61c9"}),"\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac L2 \u6b63\u5247\u5316\uff1aweight_decay"}),"\n",(0,r.jsx)(e.li,{children:"\ud83c\udfac D6 \u5b78\u7fd2\u7387\u6548\u61c9\uff1a\u8abf\u53c3"}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u5c0f\u898f\u6a21\u5be6\u9a57\u5efa\u8b70",children:"\u5c0f\u898f\u6a21\u5be6\u9a57\u5efa\u8b70"}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679c\u4f60\u53ea\u662f\u60f3\u5be6\u9a57\uff0c\u5efa\u8b70\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4f7f\u7528 9\xd79 \u68cb\u76e4"}),"\uff1a\u5927\u5e45\u6e1b\u5c11\u8a08\u7b97\u91cf"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4f7f\u7528\u5c0f\u578b\u6a21\u578b"}),"\uff1ab6c96 \u8db3\u5920\u5be6\u9a57"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6e1b\u5c11\u641c\u7d22\u6b21\u6578"}),"\uff1a100-200 visits"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4f7f\u7528\u9810\u8a13\u7df4\u6a21\u578b\u5fae\u8abf"}),"\uff1a\u6bd4\u5f9e\u96f6\u958b\u59cb\u5feb"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# 9\xd79 \u68cb\u76e4\u8a2d\u5b9a\nboardSize = 9\nmaxVisits = 100\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u5ef6\u4f38\u95b1\u8b80",children:"\u5ef6\u4f38\u95b1\u8b80"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"../source-code",children:"\u539f\u59cb\u78bc\u5c0e\u8b80"})," \u2014 \u7406\u89e3\u7a0b\u5f0f\u78bc\u7d50\u69cb"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"../contributing",children:"\u53c3\u8207\u958b\u6e90\u793e\u7fa4"})," \u2014 \u52a0\u5165\u5206\u6563\u5f0f\u8a13\u7df4"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"../../how-it-works/katago-innovations",children:"KataGo \u7684\u95dc\u9375\u5275\u65b0"})," \u2014 50 \u500d\u6548\u7387\u7684\u79d8\u5bc6"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(o,{...n})}):o(n)}},5521:(n,e,s)=>{s.d(e,{R:()=>d,x:()=>t});var l=s(6672);const r={},i=l.createContext(r);function d(n){const e=l.useContext(i);return l.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:d(n.components),l.createElement(i.Provider,{value:e},n.children)}}}]);