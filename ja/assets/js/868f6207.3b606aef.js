"use strict";(globalThis.webpackChunktemp_docusaurus=globalThis.webpackChunktemp_docusaurus||[]).push([[5236],{56769(n,e,l){l.r(e),l.d(e,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"tech/deep-dive/source-code","title":"KataGo\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u89e3\u8aac","description":"KataGo\u306e\u30b3\u30fc\u30c9\u69cb\u9020\u3001\u30b3\u30a2\u30e2\u30b8\u30e5\u30fc\u30eb\u3001\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08","source":"@site/i18n/ja/docusaurus-plugin-content-docs/current/tech/deep-dive/source-code.md","sourceDirName":"tech/deep-dive","slug":"/tech/deep-dive/source-code","permalink":"/ja/docs/tech/deep-dive/source-code","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tech/deep-dive/source-code.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"KataGo\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u89e3\u8aac","description":"KataGo\u306e\u30b3\u30fc\u30c9\u69cb\u9020\u3001\u30b3\u30a2\u30e2\u30b8\u30e5\u30fc\u30eb\u3001\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08"},"sidebar":"tutorialSidebar","previous":{"title":"\u6df1\u304f\u7814\u7a76\u3057\u305f\u3044\u65b9\u3078","permalink":"/ja/docs/tech/deep-dive/"},"next":{"title":"KataGo\u8a13\u7df4\u30e1\u30ab\u30cb\u30ba\u30e0\u89e3\u6790","permalink":"/ja/docs/tech/deep-dive/training"}}');var i=l(62615),r=l(30416);const c={sidebar_position:2,title:"KataGo\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u89e3\u8aac",description:"KataGo\u306e\u30b3\u30fc\u30c9\u69cb\u9020\u3001\u30b3\u30a2\u30e2\u30b8\u30e5\u30fc\u30eb\u3001\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08"},a="KataGo\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u89e3\u8aac",d={},o=[{value:"\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u53d6\u5f97",id:"\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u53d6\u5f97",level:2},{value:"\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020",id:"\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020",level:2},{value:"\u30b3\u30a2\u30e2\u30b8\u30e5\u30fc\u30eb\u89e3\u6790",id:"\u30b3\u30a2\u30e2\u30b8\u30e5\u30fc\u30eb\u89e3\u6790",level:2},{value:"1. game/ \u2014 \u56f2\u7881\u30eb\u30fc\u30eb",id:"1-game--\u56f2\u7881\u30eb\u30fc\u30eb",level:3},{value:"board.h / board.cpp",id:"boardh--boardcpp",level:4},{value:"rules.h / rules.cpp",id:"rulesh--rulescpp",level:4},{value:"2. search/ \u2014 MCTS\u63a2\u7d22",id:"2-search--mcts\u63a2\u7d22",level:3},{value:"search.h / search.cpp",id:"searchh--searchcpp",level:4},{value:"searchparams.h",id:"searchparamsh",level:4},{value:"3. neuralnet/ \u2014 \u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u63a8\u8ad6",id:"3-neuralnet--\u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u63a8\u8ad6",level:3},{value:"nninputs.h / nninputs.cpp",id:"nninputsh--nninputscpp",level:4},{value:"nneval.h / nneval.cpp",id:"nnevalh--nnevalcpp",level:4},{value:"4. command/ \u2014 \u30b3\u30de\u30f3\u30c9\u51e6\u7406",id:"4-command--\u30b3\u30de\u30f3\u30c9\u51e6\u7406",level:3},{value:"gtp.cpp",id:"gtpcpp",level:4},{value:"analysis.cpp",id:"analysiscpp",level:4},{value:"Python\u8a13\u7df4\u30b3\u30fc\u30c9",id:"python\u8a13\u7df4\u30b3\u30fc\u30c9",level:2},{value:"model.py \u2014 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3",id:"modelpy--\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3",level:3},{value:"train.py \u2014 \u8a13\u7df4\u30eb\u30fc\u30d7",id:"trainpy--\u8a13\u7df4\u30eb\u30fc\u30d7",level:3},{value:"\u91cd\u8981\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u5b9f\u88c5",id:"\u91cd\u8981\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u5b9f\u88c5",level:2},{value:"PUCT\u9078\u629e\u516c\u5f0f",id:"puct\u9078\u629e\u516c\u5f0f",level:3},{value:"\u4eee\u60f3\u640d\u5931",id:"\u4eee\u60f3\u640d\u5931",level:3},{value:"\u30b3\u30f3\u30d1\u30a4\u30eb\u3068\u30c7\u30d0\u30c3\u30b0",id:"\u30b3\u30f3\u30d1\u30a4\u30eb\u3068\u30c7\u30d0\u30c3\u30b0",level:2},{value:"\u30b3\u30f3\u30d1\u30a4\u30eb\uff08Debug\u30e2\u30fc\u30c9\uff09",id:"\u30b3\u30f3\u30d1\u30a4\u30ebdebug\u30e2\u30fc\u30c9",level:3},{value:"\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8",id:"\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8",level:3},{value:"\u30c7\u30d0\u30c3\u30b0\u30c6\u30af\u30cb\u30c3\u30af",id:"\u30c7\u30d0\u30c3\u30b0\u30c6\u30af\u30cb\u30c3\u30af",level:3},{value:"\u95a2\u9023\u8a18\u4e8b",id:"\u95a2\u9023\u8a18\u4e8b",level:2}];function t(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"katago\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u89e3\u8aac",children:"KataGo\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u89e3\u8aac"})}),"\n",(0,i.jsx)(e.p,{children:"\u672c\u8a18\u4e8b\u3067\u306f\u3001KataGo\u306e\u30b3\u30fc\u30c9\u69cb\u9020\u3092\u7406\u89e3\u3057\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u6df1\u304f\u7814\u7a76\u3057\u305f\u308a\u8ca2\u732e\u3057\u305f\u3044\u30a8\u30f3\u30b8\u30cb\u30a2\u306b\u5f79\u7acb\u3064\u5185\u5bb9\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002"}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u53d6\u5f97",children:"\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u53d6\u5f97"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"git clone https://github.com/lightvector/KataGo.git\ncd KataGo\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020",children:"\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"KataGo/\n\u251c\u2500\u2500 cpp/                    # C++\u30b3\u30a2\u30a8\u30f3\u30b8\u30f3\n\u2502   \u251c\u2500\u2500 main.cpp            # \u30e1\u30a4\u30f3\u30d7\u30ed\u30b0\u30e9\u30e0\u30a8\u30f3\u30c8\u30ea\n\u2502   \u251c\u2500\u2500 command/            # \u30b3\u30de\u30f3\u30c9\u51e6\u7406\n\u2502   \u251c\u2500\u2500 core/               # \u30b3\u30a2\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\n\u2502   \u251c\u2500\u2500 game/               # \u56f2\u7881\u30eb\u30fc\u30eb\n\u2502   \u251c\u2500\u2500 search/             # MCTS\u63a2\u7d22\n\u2502   \u251c\u2500\u2500 neuralnet/          # \u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u63a8\u8ad6\n\u2502   \u251c\u2500\u2500 dataio/             # \u30c7\u30fc\u30bfI/O\n\u2502   \u2514\u2500\u2500 tests/              # \u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\n\u2502\n\u251c\u2500\u2500 python/                 # Python\u8a13\u7df4\u30b3\u30fc\u30c9\n\u2502   \u251c\u2500\u2500 train.py            # \u8a13\u7df4\u30e1\u30a4\u30f3\u30d7\u30ed\u30b0\u30e9\u30e0\n\u2502   \u251c\u2500\u2500 model.py            # \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5b9a\u7fa9\n\u2502   \u251c\u2500\u2500 data/               # \u30c7\u30fc\u30bf\u51e6\u7406\n\u2502   \u2514\u2500\u2500 configs/            # \u8a13\u7df4\u8a2d\u5b9a\n\u2502\n\u2514\u2500\u2500 docs/                   # \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u30b3\u30a2\u30e2\u30b8\u30e5\u30fc\u30eb\u89e3\u6790",children:"\u30b3\u30a2\u30e2\u30b8\u30e5\u30fc\u30eb\u89e3\u6790"}),"\n",(0,i.jsx)(e.h3,{id:"1-game--\u56f2\u7881\u30eb\u30fc\u30eb",children:"1. game/ \u2014 \u56f2\u7881\u30eb\u30fc\u30eb"}),"\n",(0,i.jsx)(e.p,{children:"\u56f2\u7881\u30eb\u30fc\u30eb\u306e\u5b8c\u5168\u306a\u5b9f\u88c5\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"boardh--boardcpp",children:"board.h / board.cpp"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"// \u76e4\u9762\u72b6\u614b\u306e\u8868\u73fe\nclass Board {\npublic:\n    static constexpr int MAX_BOARD_SIZE = 19;\n\n    // \u76e4\u9762\u72b6\u614b\n    Color colors[MAX_ARR_SIZE];  // \u5404\u4f4d\u7f6e\u306e\u8272\n    Chain chains[MAX_ARR_SIZE];  // \u77f3\u7fa4\u60c5\u5831\n\n    // \u30b3\u30a2\u64cd\u4f5c\n    bool playMove(Loc loc, Player pla);  // \u4e00\u624b\u6253\u3064\n    bool isLegal(Loc loc, Player pla);   // \u5408\u6cd5\u6027\u5224\u5b9a\n    void calculateArea(Color* area);      // \u5730\u3092\u8a08\u7b97\n};\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u5bfe\u5fdc"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"A2 \u683c\u5b50\u30e2\u30c7\u30eb\uff1a\u76e4\u9762\u306e\u30c7\u30fc\u30bf\u69cb\u9020"}),"\n",(0,i.jsx)(e.li,{children:"A6 \u9023\u7d50\u9818\u57df\uff1a\u77f3\u7fa4\uff08Chain\uff09\u306e\u8868\u73fe"}),"\n",(0,i.jsx)(e.li,{children:"A7 \u547c\u5438\u70b9\u306e\u8a08\u7b97\uff1aliberty\u306e\u8ffd\u8de1"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"rulesh--rulescpp",children:"rules.h / rules.cpp"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"// \u30de\u30eb\u30c1\u30eb\u30fc\u30eb\u30b5\u30dd\u30fc\u30c8\nstruct Rules {\n    enum KoRule { SIMPLE_KO, POSITIONAL_KO, SITUATIONAL_KO };\n    enum ScoringRule { TERRITORY_SCORING, AREA_SCORING };\n    enum TaxRule { NO_TAX, TAX_SEKI, TAX_ALL };\n\n    KoRule koRule;\n    ScoringRule scoringRule;\n    TaxRule taxRule;\n    float komi;\n\n    // \u30eb\u30fc\u30eb\u540d\u5bfe\u5fdc\n    static Rules parseRules(const std::string& name);\n};\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u308b\u30eb\u30fc\u30eb\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"chinese"}),"\uff1a\u4e2d\u56fd\u30eb\u30fc\u30eb\uff08\u5730+\u77f3\uff09"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"japanese"}),"\uff1a\u65e5\u672c\u30eb\u30fc\u30eb\uff08\u5730\u306e\u307f\uff09"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"korean"}),"\uff1a\u97d3\u56fd\u30eb\u30fc\u30eb"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"aga"}),"\uff1a\u30a2\u30e1\u30ea\u30ab\u30eb\u30fc\u30eb"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"tromp-taylor"}),"\uff1aTromp-Taylor\u30eb\u30fc\u30eb"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h3,{id:"2-search--mcts\u63a2\u7d22",children:"2. search/ \u2014 MCTS\u63a2\u7d22"}),"\n",(0,i.jsx)(e.p,{children:"\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6728\u63a2\u7d22\u306e\u5b9f\u88c5\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"searchh--searchcpp",children:"search.h / search.cpp"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"class Search {\npublic:\n    // \u30b3\u30a2\u63a2\u7d22\n    void runWholeSearch(Player pla);\n\n    // MCTS\u30b9\u30c6\u30c3\u30d7\n    void selectNode();           // \u30ce\u30fc\u30c9\u9078\u629e\n    void expandNode();           // \u30ce\u30fc\u30c9\u5c55\u958b\n    void evaluateNode();         // \u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a55\u4fa1\n    void backpropValue();        // \u9006\u4f1d\u64ad\u66f4\u65b0\n\n    // \u7d50\u679c\u53d6\u5f97\n    Loc getChosenMove();\n    std::vector<MoveInfo> getSortedMoveInfos();\n};\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u5bfe\u5fdc"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"C5 MCTS\u306e4\u30b9\u30c6\u30c3\u30d7\uff1aselect \u2192 expand \u2192 evaluate \u2192 backprop\u306b\u5bfe\u5fdc"}),"\n",(0,i.jsxs)(e.li,{children:["E4 PUCT\u516c\u5f0f\uff1a",(0,i.jsx)(e.code,{children:"selectNode()"}),"\u5185\u3067\u5b9f\u88c5"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"searchparamsh",children:"searchparams.h"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"struct SearchParams {\n    // \u63a2\u7d22\u5236\u5fa1\n    int64_t maxVisits;          // \u6700\u5927\u8a2a\u554f\u56de\u6570\n    double maxTime;             // \u6700\u5927\u6642\u9593\n\n    // PUCT\u30d1\u30e9\u30e1\u30fc\u30bf\n    double cpuctExploration;    // \u63a2\u7d22\u5b9a\u6570\n    double cpuctBase;\n\n    // \u4eee\u60f3\u640d\u5931\n    int virtualLoss;\n\n    // \u30eb\u30fc\u30c8\u30ce\u30fc\u30c9\u30ce\u30a4\u30ba\n    double rootNoiseEnabled;\n    double rootDirichletAlpha;\n};\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h3,{id:"3-neuralnet--\u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u63a8\u8ad6",children:"3. neuralnet/ \u2014 \u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u63a8\u8ad6"}),"\n",(0,i.jsx)(e.p,{children:"\u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u63a8\u8ad6\u30a8\u30f3\u30b8\u30f3\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"nninputsh--nninputscpp",children:"nninputs.h / nninputs.cpp"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"// \u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5165\u529b\u7279\u5fb4\nclass NNInputs {\npublic:\n    // \u7279\u5fb4\u5e73\u9762\n    static constexpr int NUM_FEATURES = 22;\n\n    // \u7279\u5fb4\u3092\u57cb\u3081\u308b\n    static void fillFeatures(\n        const Board& board,\n        const BoardHistory& hist,\n        float* features\n    );\n};\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u5165\u529b\u7279\u5fb4\u306b\u542b\u307e\u308c\u308b\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9ed2\u77f3\u4f4d\u7f6e\u3001\u767d\u77f3\u4f4d\u7f6e"}),"\n",(0,i.jsx)(e.li,{children:"\u547c\u5438\u70b9\u6570\uff081, 2, 3+\uff09"}),"\n",(0,i.jsx)(e.li,{children:"\u5c65\u6b74\u306e\u624b"}),"\n",(0,i.jsx)(e.li,{children:"\u30eb\u30fc\u30eb\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u5bfe\u5fdc"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"A10 \u5c65\u6b74\u30b9\u30bf\u30c3\u30ad\u30f3\u30b0\uff1a\u30de\u30eb\u30c1\u30d5\u30ec\u30fc\u30e0\u5165\u529b"}),"\n",(0,i.jsx)(e.li,{children:"A11 \u5408\u6cd5\u624b\u30de\u30b9\u30af\uff1a\u7981\u6b62\u624b\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"nnevalh--nnevalcpp",children:"nneval.h / nneval.cpp"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"// \u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a55\u4fa1\u7d50\u679c\nstruct NNOutput {\n    // Policy\u51fa\u529b\uff08362\u4f4d\u7f6e\u3001\u30d1\u30b9\u542b\u3080\uff09\n    float policyProbs[NNPos::MAX_NN_POLICY_SIZE];\n\n    // Value\u51fa\u529b\n    float winProb;       // \u52dd\u7387\n    float lossProb;      // \u6557\u7387\n    float noResultProb;  // \u5f15\u304d\u5206\u3051\u7387\n\n    // \u88dc\u52a9\u51fa\u529b\n    float scoreMean;     // \u76ee\u6570\u4e88\u6e2c\n    float scoreStdev;    // \u76ee\u6570\u6a19\u6e96\u504f\u5dee\n    float lead;          // \u30ea\u30fc\u30c9\u76ee\u6570\n\n    // \u5730\u4e88\u6e2c\n    float ownership[NNPos::MAX_BOARD_AREA];\n};\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u5bfe\u5fdc"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"E1 \u65b9\u7b56\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff1apolicyProbs"}),"\n",(0,i.jsx)(e.li,{children:"E2 \u4fa1\u5024\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff1awinProb, scoreMean"}),"\n",(0,i.jsx)(e.li,{children:"E3 \u30c7\u30e5\u30a2\u30eb\u30d8\u30c3\u30c9\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff1a\u30de\u30eb\u30c1\u51fa\u529b\u30d8\u30c3\u30c9\u8a2d\u8a08"}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h3,{id:"4-command--\u30b3\u30de\u30f3\u30c9\u51e6\u7406",children:"4. command/ \u2014 \u30b3\u30de\u30f3\u30c9\u51e6\u7406"}),"\n",(0,i.jsx)(e.p,{children:"\u7570\u306a\u308b\u5b9f\u884c\u30e2\u30fc\u30c9\u306e\u5b9f\u88c5\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"gtpcpp",children:"gtp.cpp"}),"\n",(0,i.jsx)(e.p,{children:"GTP\uff08Go Text Protocol\uff09\u30e2\u30fc\u30c9\u306e\u5b9f\u88c5\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:'void MainCmds::gtp(const std::vector<std::string>& args) {\n    // \u30b3\u30de\u30f3\u30c9\u306e\u89e3\u6790\u3068\u5b9f\u884c\n    while(true) {\n        std::string line;\n        std::getline(std::cin, line);\n\n        if(line == "name") {\n            respond("KataGo");\n        }\n        else if(line.find("play") == 0) {\n            // \u7740\u624b\u30b3\u30de\u30f3\u30c9\u3092\u51e6\u7406\n        }\n        else if(line.find("genmove") == 0) {\n            // \u63a2\u7d22\u3092\u5b9f\u884c\u3057\u3066\u6700\u5584\u624b\u3092\u8fd4\u3059\n        }\n        // ... \u305d\u306e\u4ed6\u306e\u30b3\u30de\u30f3\u30c9\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"analysiscpp",children:"analysis.cpp"}),"\n",(0,i.jsx)(e.p,{children:"Analysis Engine\u306e\u5b9f\u88c5\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"void MainCmds::analysis(const std::vector<std::string>& args) {\n    while(true) {\n        // JSON\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u8aad\u307f\u8fbc\u3080\n        std::string line;\n        std::getline(std::cin, line);\n        json query = json::parse(line);\n\n        // \u76e4\u9762\u72b6\u614b\u3092\u69cb\u7bc9\n        Board board = setupBoard(query);\n\n        // \u5206\u6790\u3092\u5b9f\u884c\n        Search search(...);\n        search.runWholeSearch();\n\n        // JSON\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u51fa\u529b\n        json response = formatResponse(search);\n        std::cout << response.dump() << std::endl;\n    }\n}\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"python\u8a13\u7df4\u30b3\u30fc\u30c9",children:"Python\u8a13\u7df4\u30b3\u30fc\u30c9"}),"\n",(0,i.jsx)(e.h3,{id:"modelpy--\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3",children:"model.py \u2014 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"class Model(nn.Module):\n    def __init__(self, config):\n        super().__init__()\n\n        # \u521d\u671f\u7573\u307f\u8fbc\u307f\n        self.initial_conv = nn.Conv2d(\n            in_channels=config.input_features,\n            out_channels=config.trunk_channels,\n            kernel_size=3, padding=1\n        )\n\n        # \u6b8b\u5dee\u30bf\u30ef\u30fc\n        self.trunk = nn.ModuleList([\n            ResidualBlock(config.trunk_channels)\n            for _ in range(config.num_blocks)\n        ])\n\n        # \u51fa\u529b\u30d8\u30c3\u30c9\n        self.policy_head = PolicyHead(config)\n        self.value_head = ValueHead(config)\n        self.ownership_head = OwnershipHead(config)\n\n    def forward(self, x):\n        # \u521d\u671f\u7573\u307f\u8fbc\u307f\n        x = self.initial_conv(x)\n\n        # \u6b8b\u5dee\u30bf\u30ef\u30fc\n        for block in self.trunk:\n            x = block(x)\n\n        # \u30de\u30eb\u30c1\u30d8\u30c3\u30c9\u51fa\u529b\n        policy = self.policy_head(x)\n        value = self.value_head(x)\n        ownership = self.ownership_head(x)\n\n        return policy, value, ownership\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u5bfe\u5fdc"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"D9 \u7573\u307f\u8fbc\u307f\u6f14\u7b97\uff1aConv2d"}),"\n",(0,i.jsx)(e.li,{children:"D12 \u6b8b\u5dee\u63a5\u7d9a\uff1aResidualBlock"}),"\n",(0,i.jsx)(e.li,{children:"E11 \u6b8b\u5dee\u30bf\u30ef\u30fc\uff1atrunk\u69cb\u9020"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"trainpy--\u8a13\u7df4\u30eb\u30fc\u30d7",children:"train.py \u2014 \u8a13\u7df4\u30eb\u30fc\u30d7"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"def train_step(model, optimizer, batch):\n    # \u9806\u4f1d\u64ad\n    policy_pred, value_pred, ownership_pred = model(batch.inputs)\n\n    # \u640d\u5931\u3092\u8a08\u7b97\n    policy_loss = cross_entropy(policy_pred, batch.policy_target)\n    value_loss = mse_loss(value_pred, batch.value_target)\n    ownership_loss = mse_loss(ownership_pred, batch.ownership_target)\n\n    total_loss = policy_loss + value_loss + ownership_loss\n\n    # \u9006\u4f1d\u64ad\n    optimizer.zero_grad()\n    total_loss.backward()\n    optimizer.step()\n\n    return total_loss.item()\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u5bfe\u5fdc"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"D3 \u9806\u4f1d\u64ad\uff1amodel(batch.inputs)"}),"\n",(0,i.jsx)(e.li,{children:"D13 \u9006\u4f1d\u64ad\uff1atotal_loss.backward()"}),"\n",(0,i.jsx)(e.li,{children:"K3 Adam\uff1aoptimizer.step()"}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u91cd\u8981\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u5b9f\u88c5",children:"\u91cd\u8981\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u5b9f\u88c5"}),"\n",(0,i.jsx)(e.h3,{id:"puct\u9078\u629e\u516c\u5f0f",children:"PUCT\u9078\u629e\u516c\u5f0f"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"// search.cpp\ndouble Search::getPUCTScore(const SearchNode* node, int moveIdx) {\n    double Q = node->getChildValue(moveIdx);\n    double P = node->getChildPolicy(moveIdx);\n    double N_parent = node->visits;\n    double N_child = node->getChildVisits(moveIdx);\n\n    double exploration = params.cpuctExploration;\n    double cpuct = exploration * sqrt(N_parent) / (1.0 + N_child);\n\n    return Q + cpuct * P;\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u4eee\u60f3\u640d\u5931",children:"\u4eee\u60f3\u640d\u5931"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"// \u30de\u30eb\u30c1\u30b9\u30ec\u30c3\u30c9\u304c\u540c\u3058\u30ce\u30fc\u30c9\u3092\u9078\u629e\u3057\u306a\u3044\u3088\u3046\u306b\nvoid Search::applyVirtualLoss(SearchNode* node) {\n    node->virtualLoss += params.virtualLoss;\n}\n\nvoid Search::removeVirtualLoss(SearchNode* node) {\n    node->virtualLoss -= params.virtualLoss;\n}\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u5bfe\u5fdc"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"C9 \u4eee\u60f3\u640d\u5931\uff1a\u4e26\u5217\u63a2\u7d22\u306e\u30c6\u30af\u30cb\u30c3\u30af"}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u30b3\u30f3\u30d1\u30a4\u30eb\u3068\u30c7\u30d0\u30c3\u30b0",children:"\u30b3\u30f3\u30d1\u30a4\u30eb\u3068\u30c7\u30d0\u30c3\u30b0"}),"\n",(0,i.jsx)(e.h3,{id:"\u30b3\u30f3\u30d1\u30a4\u30ebdebug\u30e2\u30fc\u30c9",children:"\u30b3\u30f3\u30d1\u30a4\u30eb\uff08Debug\u30e2\u30fc\u30c9\uff09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"cd cpp\nmkdir build && cd build\ncmake .. -DUSE_BACKEND=OPENCL -DCMAKE_BUILD_TYPE=Debug\nmake -j$(nproc)\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8",children:"\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"./katago runtests\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u30c7\u30d0\u30c3\u30b0\u30c6\u30af\u30cb\u30c3\u30af",children:"\u30c7\u30d0\u30c3\u30b0\u30c6\u30af\u30cb\u30c3\u30af"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"// \u8a73\u7d30\u30ed\u30b0\u3092\u6709\u52b9\u5316\n#define SEARCH_DEBUG 1\n\n// \u63a2\u7d22\u306b\u30d6\u30ec\u30fc\u30af\u30dd\u30a4\u30f3\u30c8\u3092\u8ffd\u52a0\nif(node->visits > 1000) {\n    // \u30d6\u30ec\u30fc\u30af\u30dd\u30a4\u30f3\u30c8\u3092\u8a2d\u5b9a\u3057\u3066\u63a2\u7d22\u72b6\u614b\u3092\u78ba\u8a8d\n}\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u95a2\u9023\u8a18\u4e8b",children:"\u95a2\u9023\u8a18\u4e8b"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"../training",children:"KataGo\u8a13\u7df4\u30e1\u30ab\u30cb\u30ba\u30e0\u89e3\u6790"})," \u2014 \u5b8c\u5168\u306a\u8a13\u7df4\u30d5\u30ed\u30fc"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"../contributing",children:"\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3078\u306e\u53c2\u52a0"})," \u2014 \u8ca2\u732e\u30ac\u30a4\u30c9"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"/docs/animations/",children:"\u6982\u5ff5\u30af\u30a4\u30c3\u30af\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9"})," \u2014 109\u306e\u6982\u5ff5\u5bfe\u7167"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(t,{...n})}):t(n)}},30416(n,e,l){l.d(e,{R:()=>c,x:()=>a});var s=l(59471);const i={},r=s.createContext(i);function c(n){const e=s.useContext(r);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:c(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);