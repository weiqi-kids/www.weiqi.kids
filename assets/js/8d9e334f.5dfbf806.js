"use strict";(self.webpackChunktemp_docusaurus=self.webpackChunktemp_docusaurus||[]).push([[5421],{5521:(n,e,s)=>{s.d(e,{R:()=>i,x:()=>a});var r=s(6672);const o={},t=r.createContext(o);function i(n){const e=r.useContext(t);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:i(n.components),r.createElement(t.Provider,{value:e},n.children)}},9098:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"for-engineers/hands-on/integration","title":"\u6574\u5408\u5230\u4f60\u7684\u5c08\u6848","description":"Python \u8207 Node.js \u7684 KataGo API \u6574\u5408\u6307\u5357","source":"@site/docs/for-engineers/hands-on/integration.md","sourceDirName":"for-engineers/hands-on","slug":"/for-engineers/hands-on/integration","permalink":"/docs/for-engineers/hands-on/integration","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/for-engineers/hands-on/integration.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"\u6574\u5408\u5230\u4f60\u7684\u5c08\u6848","description":"Python \u8207 Node.js \u7684 KataGo API \u6574\u5408\u6307\u5357"},"sidebar":"tutorialSidebar","previous":{"title":"\u57fa\u672c\u4f7f\u7528","permalink":"/docs/for-engineers/hands-on/basic-usage"},"next":{"title":"\u4e00\u7bc7\u6587\u7ae0\u641e\u61c2\u570d\u68cb AI","permalink":"/docs/for-engineers/how-it-works/"}}');var o=s(3420),t=s(5521);const i={sidebar_position:4,title:"\u6574\u5408\u5230\u4f60\u7684\u5c08\u6848",description:"Python \u8207 Node.js \u7684 KataGo API \u6574\u5408\u6307\u5357"},a="\u6574\u5408\u5230\u4f60\u7684\u5c08\u6848",l={},d=[{value:"\u6574\u5408\u65b9\u5f0f\u9078\u64c7",id:"\u6574\u5408\u65b9\u5f0f\u9078\u64c7",level:2},{value:"Python \u6574\u5408",id:"python-\u6574\u5408",level:2},{value:"\u57fa\u672c\u67b6\u69cb",id:"\u57fa\u672c\u67b6\u69cb",level:3},{value:"\u5b8c\u6574\u7bc4\u4f8b\uff1a\u5206\u6790\u4e00\u76e4\u68cb",id:"\u5b8c\u6574\u7bc4\u4f8b\u5206\u6790\u4e00\u76e4\u68cb",level:3},{value:"\u6279\u6b21\u5206\u6790\u591a\u76e4\u68cb",id:"\u6279\u6b21\u5206\u6790\u591a\u76e4\u68cb",level:3},{value:"\u53d6\u5f97\u9818\u5730\u9810\u6e2c",id:"\u53d6\u5f97\u9818\u5730\u9810\u6e2c",level:3},{value:"Node.js \u6574\u5408",id:"nodejs-\u6574\u5408",level:2},{value:"\u57fa\u672c\u67b6\u69cb",id:"\u57fa\u672c\u67b6\u69cb-1",level:3},{value:"\u5b8c\u6574\u7bc4\u4f8b",id:"\u5b8c\u6574\u7bc4\u4f8b",level:3},{value:"Express API \u670d\u52d9",id:"express-api-\u670d\u52d9",level:3},{value:"\u4f7f\u7528 API",id:"\u4f7f\u7528-api",level:3},{value:"\u5ea7\u6a19\u8f49\u63db\u5de5\u5177",id:"\u5ea7\u6a19\u8f49\u63db\u5de5\u5177",level:2},{value:"Python",id:"python",level:3},{value:"JavaScript",id:"javascript",level:3},{value:"\u932f\u8aa4\u8655\u7406",id:"\u932f\u8aa4\u8655\u7406",level:2},{value:"\u5e38\u898b\u932f\u8aa4",id:"\u5e38\u898b\u932f\u8aa4",level:3},{value:"\u5065\u58ef\u7684\u932f\u8aa4\u8655\u7406",id:"\u5065\u58ef\u7684\u932f\u8aa4\u8655\u7406",level:3},{value:"\u6548\u80fd\u512a\u5316",id:"\u6548\u80fd\u512a\u5316",level:2},{value:"\u6279\u6b21\u8655\u7406",id:"\u6279\u6b21\u8655\u7406",level:3},{value:"\u8a2d\u5b9a\u8abf\u6574",id:"\u8a2d\u5b9a\u8abf\u6574",level:3},{value:"\u5ef6\u4f38\u95b1\u8b80",id:"\u5ef6\u4f38\u95b1\u8b80",level:2}];function c(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"\u6574\u5408\u5230\u4f60\u7684\u5c08\u6848",children:"\u6574\u5408\u5230\u4f60\u7684\u5c08\u6848"})}),"\n",(0,o.jsx)(e.p,{children:"\u672c\u6587\u4ecb\u7d39\u5982\u4f55\u5c07 KataGo \u6574\u5408\u5230\u4f60\u7684\u61c9\u7528\u7a0b\u5f0f\u4e2d\u3002"}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"\u6574\u5408\u65b9\u5f0f\u9078\u64c7",children:"\u6574\u5408\u65b9\u5f0f\u9078\u64c7"}),"\n",(0,o.jsxs)(e.table,{children:[(0,o.jsx)(e.thead,{children:(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.th,{children:"\u65b9\u5f0f"}),(0,o.jsx)(e.th,{children:"\u9069\u7528\u5834\u666f"}),(0,o.jsx)(e.th,{children:"\u8907\u96dc\u5ea6"})]})}),(0,o.jsxs)(e.tbody,{children:[(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.strong,{children:"Analysis Engine"})}),(0,o.jsx)(e.td,{children:"\u6279\u6b21\u5206\u6790\u3001API \u670d\u52d9"}),(0,o.jsx)(e.td,{children:"\u4f4e"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.strong,{children:"GTP \u6a21\u5f0f"})}),(0,o.jsx)(e.td,{children:"\u5373\u6642\u5c0d\u5f08\u3001\u4e92\u52d5\u5f0f"}),(0,o.jsx)(e.td,{children:"\u4e2d"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.strong,{children:"\u76f4\u63a5\u547c\u53eb\u51fd\u5f0f\u5eab"})}),(0,o.jsx)(e.td,{children:"\u6df1\u5ea6\u6574\u5408\u3001\u81ea\u8a02\u529f\u80fd"}),(0,o.jsx)(e.td,{children:"\u9ad8"})]})]})]}),"\n",(0,o.jsxs)(e.p,{children:["\u672c\u6587\u805a\u7126\u65bc ",(0,o.jsx)(e.strong,{children:"Analysis Engine"}),"\uff0c\u9019\u662f\u6700\u9069\u5408\u7a0b\u5f0f\u6574\u5408\u7684\u65b9\u5f0f\u3002"]}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"python-\u6574\u5408",children:"Python \u6574\u5408"}),"\n",(0,o.jsx)(e.h3,{id:"\u57fa\u672c\u67b6\u69cb",children:"\u57fa\u672c\u67b6\u69cb"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:'import subprocess\nimport json\n\nclass KataGoEngine:\n    def __init__(self, katago_path, model_path, config_path=None):\n        cmd = [katago_path, "analysis", "-model", model_path]\n        if config_path:\n            cmd.extend(["-config", config_path])\n\n        self.process = subprocess.Popen(\n            cmd,\n            stdin=subprocess.PIPE,\n            stdout=subprocess.PIPE,\n            stderr=subprocess.PIPE,\n            text=True,\n            bufsize=1\n        )\n\n    def analyze(self, query):\n        """\u9001\u51fa\u5206\u6790\u8acb\u6c42\u4e26\u53d6\u5f97\u56de\u61c9"""\n        query_str = json.dumps(query) + "\\n"\n        self.process.stdin.write(query_str)\n        self.process.stdin.flush()\n\n        response_line = self.process.stdout.readline()\n        return json.loads(response_line)\n\n    def close(self):\n        self.process.terminate()\n        self.process.wait()\n'})}),"\n",(0,o.jsx)(e.h3,{id:"\u5b8c\u6574\u7bc4\u4f8b\u5206\u6790\u4e00\u76e4\u68cb",children:"\u5b8c\u6574\u7bc4\u4f8b\uff1a\u5206\u6790\u4e00\u76e4\u68cb"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:'import json\n\n# \u521d\u59cb\u5316\u5f15\u64ce\nengine = KataGoEngine(\n    katago_path="/usr/local/bin/katago",\n    model_path="./kata-b18c384.bin.gz"\n)\n\n# \u6e96\u5099\u5206\u6790\u8acb\u6c42\nquery = {\n    "id": "game1",\n    "moves": [\n        ["B", "Q16"],\n        ["W", "D4"],\n        ["B", "Q4"],\n        ["W", "D16"]\n    ],\n    "rules": "chinese",\n    "komi": 7.5,\n    "boardXSize": 19,\n    "boardYSize": 19,\n    "analyzeTurns": [0, 1, 2, 3, 4],  # \u5206\u6790\u6bcf\u4e00\u624b\n    "maxVisits": 500\n}\n\n# \u57f7\u884c\u5206\u6790\nresult = engine.analyze(query)\n\n# \u8655\u7406\u7d50\u679c\nprint(f"\u67e5\u8a62 ID: {result[\'id\']}")\nprint(f"\u5206\u6790\u624b\u6578: {result[\'turnNumber\']}")\nprint(f"\u7576\u524d\u52dd\u7387: {result[\'rootInfo\'][\'winrate\']:.1%}")\nprint(f"\u9810\u671f\u9818\u5148: {result[\'rootInfo\'][\'scoreLead\']:.1f} \u76ee")\n\nprint("\\n\u5019\u9078\u4e0b\u6cd5\uff1a")\nfor move_info in result[\'moveInfos\'][:5]:\n    print(f"  {move_info[\'move\']}: "\n          f"\u52dd\u7387 {move_info[\'winrate\']:.1%}, "\n          f"\u8a2a\u554f {move_info[\'visits\']}, "\n          f"\u8b8a\u5316 {\' \'.join(move_info[\'pv\'][:3])}")\n\nengine.close()\n'})}),"\n",(0,o.jsx)(e.h3,{id:"\u6279\u6b21\u5206\u6790\u591a\u76e4\u68cb",children:"\u6279\u6b21\u5206\u6790\u591a\u76e4\u68cb"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:'def analyze_game(engine, moves, game_id="game"):\n    """\u5206\u6790\u4e00\u76e4\u68cb\u7684\u6240\u6709\u624b\u6578"""\n    results = []\n\n    for turn in range(len(moves) + 1):\n        query = {\n            "id": f"{game_id}_turn{turn}",\n            "moves": moves[:turn],\n            "rules": "chinese",\n            "komi": 7.5,\n            "boardXSize": 19,\n            "boardYSize": 19,\n            "analyzeTurns": [turn],\n            "maxVisits": 200\n        }\n\n        result = engine.analyze(query)\n        results.append({\n            "turn": turn,\n            "winrate": result["rootInfo"]["winrate"],\n            "scoreLead": result["rootInfo"]["scoreLead"],\n            "bestMove": result["moveInfos"][0]["move"] if result["moveInfos"] else None\n        })\n\n    return results\n\n# \u4f7f\u7528\u7bc4\u4f8b\nmoves = [["B", "Q16"], ["W", "D4"], ["B", "Q4"], ["W", "D16"]]\nanalysis = analyze_game(engine, moves)\n\nfor turn_data in analysis:\n    print(f"\u624b {turn_data[\'turn\']}: "\n          f"\u52dd\u7387 {turn_data[\'winrate\']:.1%}, "\n          f"\u6700\u4f73 {turn_data[\'bestMove\']}")\n'})}),"\n",(0,o.jsx)(e.h3,{id:"\u53d6\u5f97\u9818\u5730\u9810\u6e2c",children:"\u53d6\u5f97\u9818\u5730\u9810\u6e2c"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:'query = {\n    "id": "ownership_query",\n    "moves": [["B", "Q16"], ["W", "D4"]],\n    "rules": "chinese",\n    "komi": 7.5,\n    "boardXSize": 19,\n    "boardYSize": 19,\n    "analyzeTurns": [2],\n    "includeOwnership": True,  # \u95dc\u9375\u53c3\u6578\n    "maxVisits": 500\n}\n\nresult = engine.analyze(query)\n\n# ownership \u662f\u4e00\u500b 361 \u5143\u7d20\u7684\u9663\u5217\n# \u503c\u5728 -1\uff08\u767d\u65b9\u9818\u5730\uff09\u5230 +1\uff08\u9ed1\u65b9\u9818\u5730\uff09\u4e4b\u9593\nownership = result.get("ownership", [])\n\n# \u8f49\u63db\u70ba 19x19 \u68cb\u76e4\ndef ownership_to_board(ownership, size=19):\n    board = []\n    for row in range(size):\n        board.append(ownership[row * size:(row + 1) * size])\n    return board\n\nboard = ownership_to_board(ownership)\n\n# \u8996\u89ba\u5316\nfor row in board:\n    line = ""\n    for val in row:\n        if val > 0.5:\n            line += "\u25cf"  # \u9ed1\u65b9\u9818\u5730\n        elif val < -0.5:\n            line += "\u25cb"  # \u767d\u65b9\u9818\u5730\n        else:\n            line += "\xb7"  # \u4e2d\u7acb\n    print(line)\n'})}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"nodejs-\u6574\u5408",children:"Node.js \u6574\u5408"}),"\n",(0,o.jsx)(e.h3,{id:"\u57fa\u672c\u67b6\u69cb-1",children:"\u57fa\u672c\u67b6\u69cb"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-javascript",children:"const { spawn } = require('child_process');\nconst readline = require('readline');\n\nclass KataGoEngine {\n    constructor(katagoPath, modelPath, configPath = null) {\n        const args = ['analysis', '-model', modelPath];\n        if (configPath) {\n            args.push('-config', configPath);\n        }\n\n        this.process = spawn(katagoPath, args);\n        this.pendingQueries = new Map();\n\n        const rl = readline.createInterface({\n            input: this.process.stdout,\n            crlfDelay: Infinity\n        });\n\n        rl.on('line', (line) => {\n            try {\n                const result = JSON.parse(line);\n                const resolver = this.pendingQueries.get(result.id);\n                if (resolver) {\n                    resolver(result);\n                    this.pendingQueries.delete(result.id);\n                }\n            } catch (e) {\n                console.error('Parse error:', e);\n            }\n        });\n    }\n\n    analyze(query) {\n        return new Promise((resolve) => {\n            this.pendingQueries.set(query.id, resolve);\n            this.process.stdin.write(JSON.stringify(query) + '\\n');\n        });\n    }\n\n    close() {\n        this.process.kill();\n    }\n}\n\nmodule.exports = KataGoEngine;\n"})}),"\n",(0,o.jsx)(e.h3,{id:"\u5b8c\u6574\u7bc4\u4f8b",children:"\u5b8c\u6574\u7bc4\u4f8b"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-javascript",children:"const KataGoEngine = require('./katago-engine');\n\nasync function main() {\n    const engine = new KataGoEngine(\n        '/usr/local/bin/katago',\n        './kata-b18c384.bin.gz'\n    );\n\n    // \u7b49\u5f85\u5f15\u64ce\u555f\u52d5\n    await new Promise(resolve => setTimeout(resolve, 2000));\n\n    const query = {\n        id: 'test1',\n        moves: [['B', 'Q16'], ['W', 'D4'], ['B', 'Q4']],\n        rules: 'chinese',\n        komi: 7.5,\n        boardXSize: 19,\n        boardYSize: 19,\n        analyzeTurns: [3],\n        maxVisits: 500\n    };\n\n    const result = await engine.analyze(query);\n\n    console.log(`\u52dd\u7387: ${(result.rootInfo.winrate * 100).toFixed(1)}%`);\n    console.log(`\u9818\u5148: ${result.rootInfo.scoreLead.toFixed(1)} \u76ee`);\n\n    console.log('\\n\u5019\u9078\u4e0b\u6cd5:');\n    result.moveInfos.slice(0, 5).forEach((info, i) => {\n        console.log(`  ${i + 1}. ${info.move}: ${(info.winrate * 100).toFixed(1)}%`);\n    });\n\n    engine.close();\n}\n\nmain().catch(console.error);\n"})}),"\n",(0,o.jsx)(e.h3,{id:"express-api-\u670d\u52d9",children:"Express API \u670d\u52d9"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-javascript",children:"const express = require('express');\nconst KataGoEngine = require('./katago-engine');\n\nconst app = express();\napp.use(express.json());\n\nconst engine = new KataGoEngine(\n    '/usr/local/bin/katago',\n    './kata-b18c384.bin.gz'\n);\n\nlet queryCounter = 0;\n\napp.post('/analyze', async (req, res) => {\n    try {\n        const { moves, rules = 'chinese', komi = 7.5 } = req.body;\n\n        const query = {\n            id: `query_${++queryCounter}`,\n            moves: moves,\n            rules: rules,\n            komi: komi,\n            boardXSize: 19,\n            boardYSize: 19,\n            analyzeTurns: [moves.length],\n            maxVisits: 500\n        };\n\n        const result = await engine.analyze(query);\n\n        res.json({\n            winrate: result.rootInfo.winrate,\n            scoreLead: result.rootInfo.scoreLead,\n            bestMoves: result.moveInfos.slice(0, 5).map(info => ({\n                move: info.move,\n                winrate: info.winrate,\n                visits: info.visits\n            }))\n        });\n    } catch (error) {\n        res.status(500).json({ error: error.message });\n    }\n});\n\napp.listen(3000, () => {\n    console.log('KataGo API \u670d\u52d9\u555f\u52d5\u65bc http://localhost:3000');\n});\n"})}),"\n",(0,o.jsx)(e.h3,{id:"\u4f7f\u7528-api",children:"\u4f7f\u7528 API"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:'curl -X POST http://localhost:3000/analyze \\\n  -H "Content-Type: application/json" \\\n  -d \'{"moves": [["B","Q16"],["W","D4"],["B","Q4"]]}\'\n'})}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"\u5ea7\u6a19\u8f49\u63db\u5de5\u5177",children:"\u5ea7\u6a19\u8f49\u63db\u5de5\u5177"}),"\n",(0,o.jsx)(e.h3,{id:"python",children:"Python"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:'def coord_to_gtp(x, y, board_size=19):\n    """\u5c07 (x, y) \u5ea7\u6a19\u8f49\u63db\u70ba GTP \u683c\u5f0f\uff08\u5982 Q16\uff09"""\n    letters = \'ABCDEFGHJKLMNOPQRST\'\n    return f"{letters[x]}{board_size - y}"\n\ndef gtp_to_coord(gtp_coord, board_size=19):\n    """\u5c07 GTP \u683c\u5f0f\u8f49\u63db\u70ba (x, y) \u5ea7\u6a19"""\n    letters = \'ABCDEFGHJKLMNOPQRST\'\n    x = letters.index(gtp_coord[0].upper())\n    y = board_size - int(gtp_coord[1:])\n    return (x, y)\n\ndef sgf_to_gtp(sgf_coord, board_size=19):\n    """\u5c07 SGF \u683c\u5f0f\uff08\u5982 \'pd\'\uff09\u8f49\u63db\u70ba GTP \u683c\u5f0f\uff08\u5982 \'Q16\'\uff09"""\n    if not sgf_coord or sgf_coord == \'\':\n        return \'pass\'\n    x = ord(sgf_coord[0]) - ord(\'a\')\n    y = ord(sgf_coord[1]) - ord(\'a\')\n    return coord_to_gtp(x, y, board_size)\n\n# \u4f7f\u7528\u7bc4\u4f8b\nprint(coord_to_gtp(15, 3))    # Q16\nprint(gtp_to_coord("Q16"))    # (15, 3)\nprint(sgf_to_gtp("pd"))       # Q16\n'})}),"\n",(0,o.jsx)(e.h3,{id:"javascript",children:"JavaScript"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-javascript",children:"function coordToGtp(x, y, boardSize = 19) {\n    const letters = 'ABCDEFGHJKLMNOPQRST';\n    return `${letters[x]}${boardSize - y}`;\n}\n\nfunction gtpToCoord(gtpCoord, boardSize = 19) {\n    const letters = 'ABCDEFGHJKLMNOPQRST';\n    const x = letters.indexOf(gtpCoord[0].toUpperCase());\n    const y = boardSize - parseInt(gtpCoord.slice(1));\n    return { x, y };\n}\n\nfunction sgfToGtp(sgfCoord, boardSize = 19) {\n    if (!sgfCoord || sgfCoord === '') return 'pass';\n    const x = sgfCoord.charCodeAt(0) - 'a'.charCodeAt(0);\n    const y = sgfCoord.charCodeAt(1) - 'a'.charCodeAt(0);\n    return coordToGtp(x, y, boardSize);\n}\n"})}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"\u932f\u8aa4\u8655\u7406",children:"\u932f\u8aa4\u8655\u7406"}),"\n",(0,o.jsx)(e.h3,{id:"\u5e38\u898b\u932f\u8aa4",children:"\u5e38\u898b\u932f\u8aa4"}),"\n",(0,o.jsxs)(e.table,{children:[(0,o.jsx)(e.thead,{children:(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.th,{children:"\u932f\u8aa4"}),(0,o.jsx)(e.th,{children:"\u539f\u56e0"}),(0,o.jsx)(e.th,{children:"\u89e3\u6c7a\u65b9\u6848"})]})}),(0,o.jsxs)(e.tbody,{children:[(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"Could not load model"})}),(0,o.jsx)(e.td,{children:"\u6a21\u578b\u8def\u5f91\u932f\u8aa4"}),(0,o.jsx)(e.td,{children:"\u4f7f\u7528\u7d55\u5c0d\u8def\u5f91"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"No GPU found"})}),(0,o.jsx)(e.td,{children:"GPU \u672a\u6b63\u78ba\u8a2d\u5b9a"}),(0,o.jsx)(e.td,{children:"\u6aa2\u67e5\u9a45\u52d5\u7a0b\u5f0f\u6216\u4f7f\u7528 CPU \u7248\u672c"})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"Out of memory"})}),(0,o.jsx)(e.td,{children:"GPU \u8a18\u61b6\u9ad4\u4e0d\u8db3"}),(0,o.jsxs)(e.td,{children:["\u6e1b\u5c11 ",(0,o.jsx)(e.code,{children:"nnMaxBatchSize"})]})]}),(0,o.jsxs)(e.tr,{children:[(0,o.jsx)(e.td,{children:(0,o.jsx)(e.code,{children:"Invalid JSON"})}),(0,o.jsx)(e.td,{children:"\u8acb\u6c42\u683c\u5f0f\u932f\u8aa4"}),(0,o.jsx)(e.td,{children:"\u78ba\u8a8d JSON \u683c\u5f0f\u6b63\u78ba"})]})]})]}),"\n",(0,o.jsx)(e.h3,{id:"\u5065\u58ef\u7684\u932f\u8aa4\u8655\u7406",children:"\u5065\u58ef\u7684\u932f\u8aa4\u8655\u7406"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:'import json\nimport subprocess\nimport time\n\nclass RobustKataGoEngine:\n    def __init__(self, katago_path, model_path, max_retries=3):\n        self.katago_path = katago_path\n        self.model_path = model_path\n        self.max_retries = max_retries\n        self.process = None\n        self._start_engine()\n\n    def _start_engine(self):\n        if self.process:\n            self.process.terminate()\n\n        self.process = subprocess.Popen(\n            [self.katago_path, "analysis", "-model", self.model_path],\n            stdin=subprocess.PIPE,\n            stdout=subprocess.PIPE,\n            stderr=subprocess.PIPE,\n            text=True,\n            bufsize=1\n        )\n        time.sleep(2)  # \u7b49\u5f85\u5f15\u64ce\u555f\u52d5\n\n    def analyze(self, query, timeout=30):\n        for attempt in range(self.max_retries):\n            try:\n                query_str = json.dumps(query) + "\\n"\n                self.process.stdin.write(query_str)\n                self.process.stdin.flush()\n\n                # \u8a2d\u5b9a\u8b80\u53d6\u8d85\u6642\n                import select\n                ready, _, _ = select.select(\n                    [self.process.stdout], [], [], timeout\n                )\n\n                if ready:\n                    response_line = self.process.stdout.readline()\n                    return json.loads(response_line)\n                else:\n                    raise TimeoutError("\u5206\u6790\u8d85\u6642")\n\n            except Exception as e:\n                print(f"\u5617\u8a66 {attempt + 1} \u5931\u6557: {e}")\n                if attempt < self.max_retries - 1:\n                    self._start_engine()\n                else:\n                    raise\n\n    def close(self):\n        if self.process:\n            self.process.terminate()\n            self.process.wait()\n'})}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"\u6548\u80fd\u512a\u5316",children:"\u6548\u80fd\u512a\u5316"}),"\n",(0,o.jsx)(e.h3,{id:"\u6279\u6b21\u8655\u7406",children:"\u6279\u6b21\u8655\u7406"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:'def batch_analyze(engine, queries):\n    """\u540c\u6642\u9001\u51fa\u591a\u500b\u67e5\u8a62\u4ee5\u63d0\u5347\u6548\u7387"""\n    results = {}\n\n    # \u9001\u51fa\u6240\u6709\u67e5\u8a62\n    for query in queries:\n        query_str = json.dumps(query) + "\\n"\n        engine.process.stdin.write(query_str)\n    engine.process.stdin.flush()\n\n    # \u6536\u96c6\u6240\u6709\u56de\u61c9\n    for _ in queries:\n        response_line = engine.process.stdout.readline()\n        result = json.loads(response_line)\n        results[result[\'id\']] = result\n\n    return results\n'})}),"\n",(0,o.jsx)(e.h3,{id:"\u8a2d\u5b9a\u8abf\u6574",children:"\u8a2d\u5b9a\u8abf\u6574"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ini",children:"# \u9ad8\u6548\u80fd\u8a2d\u5b9a\uff08\u9069\u5408\u6279\u6b21\u5206\u6790\uff09\nnumSearchThreads = 8\nnnMaxBatchSize = 32\nmaxVisits = 500\n\n# \u4f4e\u5ef6\u9072\u8a2d\u5b9a\uff08\u9069\u5408\u5373\u6642\u56de\u61c9\uff09\nnumSearchThreads = 4\nnnMaxBatchSize = 8\nmaxVisits = 200\n"})}),"\n",(0,o.jsx)(e.hr,{}),"\n",(0,o.jsx)(e.h2,{id:"\u5ef6\u4f38\u95b1\u8b80",children:"\u5ef6\u4f38\u95b1\u8b80"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.a,{href:"../basic-usage",children:"\u57fa\u672c\u4f7f\u7528"})," \u2014 GTP \u8207 Analysis Engine \u6307\u4ee4"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.a,{href:"../../how-it-works/",children:"\u4e00\u7bc7\u6587\u7ae0\u641e\u61c2\u570d\u68cb AI"})," \u2014 \u4e86\u89e3\u6280\u8853\u539f\u7406"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.a,{href:"../../deep-dive/source-code",children:"KataGo \u539f\u59cb\u78bc\u5c0e\u8b80"})," \u2014 \u6df1\u5165\u7a0b\u5f0f\u78bc"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(c,{...n})}):c(n)}}}]);