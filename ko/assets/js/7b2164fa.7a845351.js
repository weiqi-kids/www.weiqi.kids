"use strict";(globalThis.webpackChunktemp_docusaurus=globalThis.webpackChunktemp_docusaurus||[]).push([[8798],{67708(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"for-engineers/deep-dive/mcts-implementation","title":"MCTS \uad6c\ud604 \uc138\ubd80\uc0ac\ud56d","description":"\ubaac\ud14c\uce74\ub97c\ub85c \ud2b8\ub9ac \ud0d0\uc0c9 \uad6c\ud604, PUCT \uc120\ud0dd \ubc0f \ubcd1\ub82c\ud654 \uae30\uc220 \uc2ec\uce35 \ubd84\uc11d","source":"@site/i18n/ko/docusaurus-plugin-content-docs/current/for-engineers/deep-dive/mcts-implementation.md","sourceDirName":"for-engineers/deep-dive","slug":"/for-engineers/deep-dive/mcts-implementation","permalink":"/ko/docs/for-engineers/deep-dive/mcts-implementation","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/for-engineers/deep-dive/mcts-implementation.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"MCTS \uad6c\ud604 \uc138\ubd80\uc0ac\ud56d","description":"\ubaac\ud14c\uce74\ub97c\ub85c \ud2b8\ub9ac \ud0d0\uc0c9 \uad6c\ud604, PUCT \uc120\ud0dd \ubc0f \ubcd1\ub82c\ud654 \uae30\uc220 \uc2ec\uce35 \ubd84\uc11d"},"sidebar":"tutorialSidebar","previous":{"title":"\uc2e0\uacbd\ub9dd \uc544\ud0a4\ud14d\ucc98 \uc0c1\uc138 \ubd84\uc11d","permalink":"/ko/docs/for-engineers/deep-dive/neural-network"},"next":{"title":"GPU \ubc31\uc5d4\ub4dc\uc640 \ucd5c\uc801\ud654","permalink":"/ko/docs/for-engineers/deep-dive/gpu-optimization"}}');var i=s(62615),t=s(30416);const r={sidebar_position:5,title:"MCTS \uad6c\ud604 \uc138\ubd80\uc0ac\ud56d",description:"\ubaac\ud14c\uce74\ub97c\ub85c \ud2b8\ub9ac \ud0d0\uc0c9 \uad6c\ud604, PUCT \uc120\ud0dd \ubc0f \ubcd1\ub82c\ud654 \uae30\uc220 \uc2ec\uce35 \ubd84\uc11d"},a="MCTS \uad6c\ud604 \uc138\ubd80\uc0ac\ud56d",d={},c=[{value:"MCTS 4\ub2e8\uacc4 \ubcf5\uc2b5",id:"mcts-4\ub2e8\uacc4-\ubcf5\uc2b5",level:2},{value:"\ub178\ub4dc \ub370\uc774\ud130 \uad6c\uc870",id:"\ub178\ub4dc-\ub370\uc774\ud130-\uad6c\uc870",level:2},{value:"\ud575\uc2ec \ub370\uc774\ud130",id:"\ud575\uc2ec-\ub370\uc774\ud130",level:3},{value:"\uba54\ubaa8\ub9ac \ucd5c\uc801\ud654",id:"\uba54\ubaa8\ub9ac-\ucd5c\uc801\ud654",level:3},{value:"Selection: PUCT \uc120\ud0dd",id:"selection-puct-\uc120\ud0dd",level:2},{value:"PUCT \uacf5\uc2dd",id:"puct-\uacf5\uc2dd",level:3},{value:"\ud30c\ub77c\ubbf8\ud130 \uc124\uba85",id:"\ud30c\ub77c\ubbf8\ud130-\uc124\uba85",level:3},{value:"\uad6c\ud604",id:"\uad6c\ud604",level:3},{value:"\ud0d0\uc0c9 vs \ud65c\uc6a9\uc758 \uade0\ud615",id:"\ud0d0\uc0c9-vs-\ud65c\uc6a9\uc758-\uade0\ud615",level:3},{value:"Expansion: \ub178\ub4dc \ud655\uc7a5",id:"expansion-\ub178\ub4dc-\ud655\uc7a5",level:2},{value:"\ud655\uc7a5 \uc870\uac74",id:"\ud655\uc7a5-\uc870\uac74",level:3},{value:"\ud569\ubc95 \ucc29\uc218 \ud544\ud130\ub9c1",id:"\ud569\ubc95-\ucc29\uc218-\ud544\ud130\ub9c1",level:3},{value:"Evaluation: \uc2e0\uacbd\ub9dd \ud3c9\uac00",id:"evaluation-\uc2e0\uacbd\ub9dd-\ud3c9\uac00",level:2},{value:"\ub2e8\uc77c \ud3c9\uac00",id:"\ub2e8\uc77c-\ud3c9\uac00",level:3},{value:"\ubc30\uce58 \ud3c9\uac00 (\ud575\uc2ec \ucd5c\uc801\ud654)",id:"\ubc30\uce58-\ud3c9\uac00-\ud575\uc2ec-\ucd5c\uc801\ud654",level:3},{value:"Backpropagation: \uc5ed\uc804\ud30c \uc5c5\ub370\uc774\ud2b8",id:"backpropagation-\uc5ed\uc804\ud30c-\uc5c5\ub370\uc774\ud2b8",level:2},{value:"\uae30\ubcf8 \uc5ed\uc804\ud30c",id:"\uae30\ubcf8-\uc5ed\uc804\ud30c",level:3},{value:"\uad00\uc810 \uad50\ub300\uc758 \uc911\uc694\uc131",id:"\uad00\uc810-\uad50\ub300\uc758-\uc911\uc694\uc131",level:3},{value:"\ubcd1\ub82c\ud654: \uac00\uc0c1 \uc190\uc2e4",id:"\ubcd1\ub82c\ud654-\uac00\uc0c1-\uc190\uc2e4",level:2},{value:"\ubb38\uc81c",id:"\ubb38\uc81c",level:3},{value:"\ud574\uacb0\ucc45: \uac00\uc0c1 \uc190\uc2e4",id:"\ud574\uacb0\ucc45-\uac00\uc0c1-\uc190\uc2e4",level:3},{value:"\ud6a8\uacfc",id:"\ud6a8\uacfc",level:3},{value:"\uc804\uccb4 \ud0d0\uc0c9 \uad6c\ud604",id:"\uc804\uccb4-\ud0d0\uc0c9-\uad6c\ud604",level:2},{value:"\uace0\uae09 \uae30\uc220",id:"\uace0\uae09-\uae30\uc220",level:2},{value:"Dirichlet \ub178\uc774\uc988",id:"dirichlet-\ub178\uc774\uc988",level:3},{value:"\uc628\ub3c4 \ud30c\ub77c\ubbf8\ud130",id:"\uc628\ub3c4-\ud30c\ub77c\ubbf8\ud130",level:3},{value:"\ud2b8\ub9ac \uc7ac\uc0ac\uc6a9",id:"\ud2b8\ub9ac-\uc7ac\uc0ac\uc6a9",level:3},{value:"\uc131\ub2a5 \ucd5c\uc801\ud654 \uc694\uc57d",id:"\uc131\ub2a5-\ucd5c\uc801\ud654-\uc694\uc57d",level:2},{value:"\ucd94\uac00 \uc77d\uae30",id:"\ucd94\uac00-\uc77d\uae30",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"mcts-\uad6c\ud604-\uc138\ubd80\uc0ac\ud56d",children:"MCTS \uad6c\ud604 \uc138\ubd80\uc0ac\ud56d"})}),"\n",(0,i.jsx)(n.p,{children:"\uc774 \ubb38\uc11c\ub294 KataGo\uc758 \ubaac\ud14c\uce74\ub97c\ub85c \ud2b8\ub9ac \ud0d0\uc0c9(MCTS) \uad6c\ud604 \uc138\ubd80\uc0ac\ud56d\uc744 \ub370\uc774\ud130 \uad6c\uc870, \uc120\ud0dd \uc804\ub7b5 \ubc0f \ubcd1\ub82c\ud654 \uae30\uc220\uc744 \ud3ec\ud568\ud558\uc5ec \uc2ec\uce35\uc801\uc73c\ub85c \ubd84\uc11d\ud569\ub2c8\ub2e4."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"mcts-4\ub2e8\uacc4-\ubcf5\uc2b5",children:"MCTS 4\ub2e8\uacc4 \ubcf5\uc2b5"}),"\n",(0,i.jsx)(n.mermaid,{value:'flowchart TB\n    subgraph MCTS["MCTS \ud0d0\uc0c9 \ub8e8\ud504"]\n        S["1. Selection<br/>\uc120\ud0dd: \ud2b8\ub9ac\ub97c \ub530\ub77c \ub0b4\ub824\uac00\uba70 PUCT\ub85c \ub178\ub4dc \uc120\ud0dd"]\n        S --\x3e E["2. Expansion<br/>\ud655\uc7a5: \ub9ac\ud504 \ub178\ub4dc\uc5d0 \ub3c4\ub2ec\ud558\uba74 \uc790\uc2dd \ub178\ub4dc \uc0dd\uc131"]\n        E --\x3e V["3. Evaluation<br/>\ud3c9\uac00: \uc2e0\uacbd\ub9dd\uc73c\ub85c \ub9ac\ud504 \ub178\ub4dc \ud3c9\uac00"]\n        V --\x3e B["4. Backprop<br/>\uc5ed\uc804\ud30c: \uacbd\ub85c\uc0c1\uc758 \ubaa8\ub4e0 \ub178\ub4dc \ud1b5\uacc4 \uc5c5\ub370\uc774\ud2b8"]\n        B -.->|"\uc218\ucc9c \ubc88 \ubc18\ubcf5"| S\n    end\n    MCTS --\x3e Result["\ubc29\ubb38 \ud69f\uc218\uac00 \uac00\uc7a5 \ub9ce\uc740 \ucc29\uc218 \uc120\ud0dd"]'}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ub178\ub4dc-\ub370\uc774\ud130-\uad6c\uc870",children:"\ub178\ub4dc \ub370\uc774\ud130 \uad6c\uc870"}),"\n",(0,i.jsx)(n.h3,{id:"\ud575\uc2ec-\ub370\uc774\ud130",children:"\ud575\uc2ec \ub370\uc774\ud130"}),"\n",(0,i.jsx)(n.p,{children:"\uac01 MCTS \ub178\ub4dc\ub294 \ub2e4\uc74c\uc744 \uc800\uc7a5\ud574\uc57c \ud569\ub2c8\ub2e4:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'class MCTSNode:\n    def __init__(self, state, parent=None, prior=0.0):\n        # \uae30\ubcf8 \uc815\ubcf4\n        self.state = state              # \ubc14\ub451\ud310 \uc0c1\ud0dc\n        self.parent = parent            # \ubd80\ubaa8 \ub178\ub4dc\n        self.children = {}              # \uc790\uc2dd \ub178\ub4dc \ub515\uc154\ub108\ub9ac {action: node}\n        self.action = None              # \uc774 \ub178\ub4dc\uc5d0 \ub3c4\ub2ec\ud55c \ucc29\uc218\n\n        # \ud1b5\uacc4 \uc815\ubcf4\n        self.visit_count = 0            # N(s): \ubc29\ubb38 \ud69f\uc218\n        self.value_sum = 0.0            # W(s): \uac00\uce58 \ud569\uacc4\n        self.prior = prior              # P(s,a): \uc0ac\uc804 \ud655\ub960\n\n        # \ubcd1\ub82c \ud0d0\uc0c9\uc6a9\n        self.virtual_loss = 0           # \uac00\uc0c1 \uc190\uc2e4\n        self.is_expanded = False        # \ud655\uc7a5 \uc5ec\ubd80\n\n    @property\n    def value(self):\n        """Q(s) = W(s) / N(s)"""\n        if self.visit_count == 0:\n            return 0.0\n        return self.value_sum / self.visit_count\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\uba54\ubaa8\ub9ac-\ucd5c\uc801\ud654",children:"\uba54\ubaa8\ub9ac \ucd5c\uc801\ud654"}),"\n",(0,i.jsx)(n.p,{children:"KataGo\ub294 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc744 \uc904\uc774\uae30 \uc704\ud574 \ub2e4\uc591\ud55c \uae30\uc220\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Python dict \ub300\uc2e0 numpy \ubc30\uc5f4 \uc0ac\uc6a9\nclass OptimizedNode:\n    __slots__ = ['visit_count', 'value_sum', 'prior', 'children_indices']\n\n    def __init__(self):\n        self.visit_count = np.int32(0)\n        self.value_sum = np.float32(0.0)\n        self.prior = np.float32(0.0)\n        self.children_indices = None  # \uc9c0\uc5f0 \ud560\ub2f9\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"selection-puct-\uc120\ud0dd",children:"Selection: PUCT \uc120\ud0dd"}),"\n",(0,i.jsx)(n.h3,{id:"puct-\uacf5\uc2dd",children:"PUCT \uacf5\uc2dd"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\uc120\ud0dd \uc810\uc218 = Q(s,a) + U(s,a)\n\n\uc5ec\uae30\uc11c:\nQ(s,a) = W(s,a) / N(s,a)              # \ud3c9\uade0 \uac00\uce58\nU(s,a) = c_puct \xd7 P(s,a) \xd7 \u221a(N(s)) / (1 + N(s,a))  # \ud0d0\uc0c9 \ud56d\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\ud30c\ub77c\ubbf8\ud130-\uc124\uba85",children:"\ud30c\ub77c\ubbf8\ud130 \uc124\uba85"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\uae30\ud638"}),(0,i.jsx)(n.th,{children:"\uc758\ubbf8"}),(0,i.jsx)(n.th,{children:"\uc804\ud615\uc801\uc778 \uac12"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Q(s,a)"}),(0,i.jsx)(n.td,{children:"\ucc29\uc218 a\uc758 \ud3c9\uade0 \uac00\uce58"}),(0,i.jsx)(n.td,{children:"[-1, +1]"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"P(s,a)"}),(0,i.jsx)(n.td,{children:"\uc2e0\uacbd\ub9dd\uc758 \uc0ac\uc804 \ud655\ub960"}),(0,i.jsx)(n.td,{children:"[0, 1]"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"N(s)"}),(0,i.jsx)(n.td,{children:"\ubd80\ubaa8 \ub178\ub4dc \ubc29\ubb38 \ud69f\uc218"}),(0,i.jsx)(n.td,{children:"\uc815\uc218"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"N(s,a)"}),(0,i.jsx)(n.td,{children:"\ucc29\uc218 a\uc758 \ubc29\ubb38 \ud69f\uc218"}),(0,i.jsx)(n.td,{children:"\uc815\uc218"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"c_puct"}),(0,i.jsx)(n.td,{children:"\ud0d0\uc0c9 \uc0c1\uc218"}),(0,i.jsx)(n.td,{children:"1.0 ~ 2.5"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"\uad6c\ud604",children:"\uad6c\ud604"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def select_child(self, c_puct=1.5):\n    """PUCT \uc810\uc218\uac00 \uac00\uc7a5 \ub192\uc740 \uc790\uc2dd \ub178\ub4dc \uc120\ud0dd"""\n    best_score = -float(\'inf\')\n    best_action = None\n    best_child = None\n\n    # \ubd80\ubaa8 \ub178\ub4dc \ubc29\ubb38 \ud69f\uc218\uc758 \uc81c\uacf1\uadfc\n    sqrt_parent_visits = math.sqrt(self.visit_count)\n\n    for action, child in self.children.items():\n        # Q \uac12 (\ud3c9\uade0 \uac00\uce58)\n        if child.visit_count > 0:\n            q_value = child.value_sum / child.visit_count\n        else:\n            q_value = 0.0\n\n        # U \uac12 (\ud0d0\uc0c9 \ud56d)\n        u_value = c_puct * child.prior * sqrt_parent_visits / (1 + child.visit_count)\n\n        # \ucd1d \uc810\uc218\n        score = q_value + u_value\n\n        if score > best_score:\n            best_score = score\n            best_action = action\n            best_child = child\n\n    return best_action, best_child\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\ud0d0\uc0c9-vs-\ud65c\uc6a9\uc758-\uade0\ud615",children:"\ud0d0\uc0c9 vs \ud65c\uc6a9\uc758 \uade0\ud615"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\ucd08\uae30: N(s,a) \uc791\uc74c\n\u251c\u2500\u2500 U(s,a) \ud07c \u2192 \ud0d0\uc0c9 \uc704\uc8fc\n\u2514\u2500\u2500 \ub192\uc740 \uc0ac\uc804 \ud655\ub960\uc758 \ucc29\uc218\uac00 \uba3c\uc800 \ud0d0\uc0c9\ub428\n\n\ud6c4\uae30: N(s,a) \ud07c\n\u251c\u2500\u2500 U(s,a) \uc791\uc74c \u2192 \ud65c\uc6a9 \uc704\uc8fc\n\u2514\u2500\u2500 Q(s,a)\uac00 \uc8fc\ub3c4, \uc774\ubbf8 \uc54c\ub824\uc9c4 \uc88b\uc740 \ucc29\uc218 \uc120\ud0dd\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"expansion-\ub178\ub4dc-\ud655\uc7a5",children:"Expansion: \ub178\ub4dc \ud655\uc7a5"}),"\n",(0,i.jsx)(n.h3,{id:"\ud655\uc7a5-\uc870\uac74",children:"\ud655\uc7a5 \uc870\uac74"}),"\n",(0,i.jsx)(n.p,{children:"\ub9ac\ud504 \ub178\ub4dc\uc5d0 \ub3c4\ub2ec\ud558\uba74 \uc2e0\uacbd\ub9dd\uc744 \uc0ac\uc6a9\ud558\uc5ec \ud655\uc7a5\ud569\ub2c8\ub2e4:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def expand(self, policy_probs, legal_moves):\n    """\ub178\ub4dc \ud655\uc7a5, \ubaa8\ub4e0 \ud569\ubc95 \ucc29\uc218\uc5d0 \ub300\ud55c \uc790\uc2dd \ub178\ub4dc \uc0dd\uc131"""\n    for action in legal_moves:\n        if action not in self.children:\n            prior = policy_probs[action]  # \uc2e0\uacbd\ub9dd \uc608\uce21 \ud655\ub960\n            child_state = self.state.play(action)\n            self.children[action] = MCTSNode(\n                state=child_state,\n                parent=self,\n                prior=prior\n            )\n\n    self.is_expanded = True\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\ud569\ubc95-\ucc29\uc218-\ud544\ud130\ub9c1",children:"\ud569\ubc95 \ucc29\uc218 \ud544\ud130\ub9c1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def get_legal_moves(state):\n    """\ubaa8\ub4e0 \ud569\ubc95 \ucc29\uc218 \uac00\uc838\uc624\uae30"""\n    legal = []\n    for i in range(361):\n        x, y = i // 19, i % 19\n        if state.is_legal(x, y):\n            legal.append(i)\n\n    # \ud328\uc2a4 \ucd94\uac00\n    legal.append(361)\n\n    return legal\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"evaluation-\uc2e0\uacbd\ub9dd-\ud3c9\uac00",children:"Evaluation: \uc2e0\uacbd\ub9dd \ud3c9\uac00"}),"\n",(0,i.jsx)(n.h3,{id:"\ub2e8\uc77c-\ud3c9\uac00",children:"\ub2e8\uc77c \ud3c9\uac00"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def evaluate(self, state):\n    """\uc2e0\uacbd\ub9dd\uc73c\ub85c \uad6d\uba74 \ud3c9\uac00"""\n    # \uc785\ub825 \ud2b9\uc131 \uc778\ucf54\ub529\n    features = encode_state(state)  # (22, 19, 19)\n    features = torch.tensor(features).unsqueeze(0)  # (1, 22, 19, 19)\n\n    # \uc2e0\uacbd\ub9dd \ucd94\ub860\n    with torch.no_grad():\n        output = self.network(features)\n\n    policy = output[\'policy\'][0].numpy()  # (362,)\n    value = output[\'value\'][0].item()     # scalar\n\n    return policy, value\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\ubc30\uce58-\ud3c9\uac00-\ud575\uc2ec-\ucd5c\uc801\ud654",children:"\ubc30\uce58 \ud3c9\uac00 (\ud575\uc2ec \ucd5c\uc801\ud654)"}),"\n",(0,i.jsx)(n.p,{children:"GPU\ub294 \ubc30\uce58 \ucd94\ub860 \uc2dc \ud6a8\uc728\uc774 \uac00\uc7a5 \ub192\uc2b5\ub2c8\ub2e4:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'class BatchedEvaluator:\n    def __init__(self, network, batch_size=8):\n        self.network = network\n        self.batch_size = batch_size\n        self.pending = []  # \ud3c9\uac00 \ub300\uae30 \uc911\uc778 (state, callback) \ub9ac\uc2a4\ud2b8\n\n    def request_evaluation(self, state, callback):\n        """\ud3c9\uac00 \uc694\uccad, \ubc30\uce58\uac00 \ucc28\uba74 \uc790\ub3d9 \uc2e4\ud589"""\n        self.pending.append((state, callback))\n\n        if len(self.pending) >= self.batch_size:\n            self.flush()\n\n    def flush(self):\n        """\ubc30\uce58 \ud3c9\uac00 \uc2e4\ud589"""\n        if not self.pending:\n            return\n\n        # \ubc30\uce58 \uc785\ub825 \uc900\ube44\n        states = [s for s, _ in self.pending]\n        features = torch.stack([encode_state(s) for s in states])\n\n        # \ubc30\uce58 \ucd94\ub860\n        with torch.no_grad():\n            outputs = self.network(features)\n\n        # \uacb0\uacfc \ucf5c\ubc31\n        for i, (_, callback) in enumerate(self.pending):\n            policy = outputs[\'policy\'][i].numpy()\n            value = outputs[\'value\'][i].item()\n            callback(policy, value)\n\n        self.pending.clear()\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"backpropagation-\uc5ed\uc804\ud30c-\uc5c5\ub370\uc774\ud2b8",children:"Backpropagation: \uc5ed\uc804\ud30c \uc5c5\ub370\uc774\ud2b8"}),"\n",(0,i.jsx)(n.h3,{id:"\uae30\ubcf8-\uc5ed\uc804\ud30c",children:"\uae30\ubcf8 \uc5ed\uc804\ud30c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def backpropagate(self, value):\n    """\ub9ac\ud504 \ub178\ub4dc\uc5d0\uc11c \ub8e8\ud2b8 \ub178\ub4dc\ub85c \uc5ed\uc804\ud30c, \ud1b5\uacc4 \uc815\ubcf4 \uc5c5\ub370\uc774\ud2b8"""\n    node = self\n\n    while node is not None:\n        node.visit_count += 1\n        node.value_sum += value\n\n        # \uad00\uc810 \uad50\ub300: \uc0c1\ub300\uc758 \uac00\uce58\ub294 \ubc18\ub300\n        value = -value\n\n        node = node.parent\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\uad00\uc810-\uad50\ub300\uc758-\uc911\uc694\uc131",children:"\uad00\uc810 \uad50\ub300\uc758 \uc911\uc694\uc131"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\ud751 \uad00\uc810: value = +0.6 (\ud751 \uc720\ub9ac)\n\n\uc5ed\uc804\ud30c \uacbd\ub85c:\n\ub9ac\ud504 \ub178\ub4dc (\ud751 \ucc28\ub840): value_sum += +0.6\n    \u2191\n\ubd80\ubaa8 \ub178\ub4dc (\ubc31 \ucc28\ub840): value_sum += -0.6  \u2190 \ubc31\uc5d0\uac8c\ub294 \ubd88\ub9ac\n    \u2191\n\uc870\ubd80\ubaa8 \ub178\ub4dc (\ud751 \ucc28\ub840): value_sum += +0.6\n    \u2191\n...\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ubcd1\ub82c\ud654-\uac00\uc0c1-\uc190\uc2e4",children:"\ubcd1\ub82c\ud654: \uac00\uc0c1 \uc190\uc2e4"}),"\n",(0,i.jsx)(n.h3,{id:"\ubb38\uc81c",children:"\ubb38\uc81c"}),"\n",(0,i.jsx)(n.p,{children:"\uc5ec\ub7ec \uc2a4\ub808\ub4dc\uac00 \ub3d9\uc2dc\uc5d0 \ud0d0\uc0c9\ud560 \ub54c \uac19\uc740 \ub178\ub4dc\ub97c \uc120\ud0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Thread 1: \ub178\ub4dc A \uc120\ud0dd (Q=0.6, N=100)\nThread 2: \ub178\ub4dc A \uc120\ud0dd (Q=0.6, N=100) \u2190 \uc911\ubcf5!\nThread 3: \ub178\ub4dc A \uc120\ud0dd (Q=0.6, N=100) \u2190 \uc911\ubcf5!\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\ud574\uacb0\ucc45-\uac00\uc0c1-\uc190\uc2e4",children:"\ud574\uacb0\ucc45: \uac00\uc0c1 \uc190\uc2e4"}),"\n",(0,i.jsx)(n.p,{children:'\ub178\ub4dc \uc120\ud0dd \uc2dc \uba3c\uc800 "\uac00\uc0c1 \uc190\uc2e4"\uc744 \ucd94\uac00\ud558\uc5ec \ub2e4\ub978 \uc2a4\ub808\ub4dc\uac00 \uc120\ud0dd\ud558\uc9c0 \uc54a\ub3c4\ub85d \ud569\ub2c8\ub2e4:'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'VIRTUAL_LOSS = 3  # \uac00\uc0c1 \uc190\uc2e4 \uac12\n\ndef select_with_virtual_loss(self):\n    """\uac00\uc0c1 \uc190\uc2e4\uc774 \ud3ec\ud568\ub41c \uc120\ud0dd"""\n    action, child = self.select_child()\n\n    # \uac00\uc0c1 \uc190\uc2e4 \ucd94\uac00\n    child.visit_count += VIRTUAL_LOSS\n    child.value_sum -= VIRTUAL_LOSS  # \uc84c\ub2e4\uace0 \uac00\uc815\n\n    return action, child\n\ndef backpropagate_with_virtual_loss(self, value):\n    """\uc5ed\uc804\ud30c \uc2dc \uac00\uc0c1 \uc190\uc2e4 \uc81c\uac70"""\n    node = self\n\n    while node is not None:\n        # \uac00\uc0c1 \uc190\uc2e4 \uc81c\uac70\n        node.visit_count -= VIRTUAL_LOSS\n        node.value_sum += VIRTUAL_LOSS\n\n        # \uc815\uc0c1 \uc5c5\ub370\uc774\ud2b8\n        node.visit_count += 1\n        node.value_sum += value\n\n        value = -value\n        node = node.parent\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\ud6a8\uacfc",children:"\ud6a8\uacfc"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Thread 1: \ub178\ub4dc A \uc120\ud0dd, \uac00\uc0c1 \uc190\uc2e4 \ucd94\uac00\n         A\uc758 Q \uac12\uc774 \uc77c\uc2dc\uc801\uc73c\ub85c \uac10\uc18c\n\nThread 2: \ub178\ub4dc B \uc120\ud0dd (A\uac00 \ub098\ube60 \ubcf4\uc774\ubbc0\ub85c)\n\nThread 3: \ub178\ub4dc C \uc120\ud0dd\n\n\u2192 \ub2e4\ub978 \uc2a4\ub808\ub4dc\uac00 \ub2e4\ub978 \ubd84\uae30 \ud0d0\uc0c9, \ud6a8\uc728\uc131 \ud5a5\uc0c1\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\uc804\uccb4-\ud0d0\uc0c9-\uad6c\ud604",children:"\uc804\uccb4 \ud0d0\uc0c9 \uad6c\ud604"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'class MCTS:\n    def __init__(self, network, c_puct=1.5, num_simulations=800):\n        self.network = network\n        self.c_puct = c_puct\n        self.num_simulations = num_simulations\n        self.evaluator = BatchedEvaluator(network)\n\n    def search(self, root_state):\n        """MCTS \ud0d0\uc0c9 \uc2e4\ud589"""\n        root = MCTSNode(root_state)\n\n        # \ub8e8\ud2b8 \ub178\ub4dc \ud655\uc7a5\n        policy, value = self.evaluate(root_state)\n        legal_moves = get_legal_moves(root_state)\n        root.expand(policy, legal_moves)\n\n        # \uc2dc\ubbac\ub808\uc774\uc158 \uc2e4\ud589\n        for _ in range(self.num_simulations):\n            node = root\n            path = [node]\n\n            # Selection: \ud2b8\ub9ac\ub97c \ub530\ub77c \ub0b4\ub824\uac10\n            while node.is_expanded and node.children:\n                action, node = node.select_child(self.c_puct)\n                path.append(node)\n\n            # Expansion + Evaluation\n            if not node.is_expanded:\n                policy, value = self.evaluate(node.state)\n                legal_moves = get_legal_moves(node.state)\n\n                if legal_moves:\n                    node.expand(policy, legal_moves)\n\n            # Backpropagation\n            for n in reversed(path):\n                n.visit_count += 1\n                n.value_sum += value\n                value = -value\n\n        # \ubc29\ubb38 \ud69f\uc218\uac00 \uac00\uc7a5 \ub9ce\uc740 \ucc29\uc218 \uc120\ud0dd\n        best_action = max(root.children.items(),\n                         key=lambda x: x[1].visit_count)[0]\n\n        return best_action\n\n    def evaluate(self, state):\n        features = encode_state(state)\n        features = torch.tensor(features).unsqueeze(0)\n\n        with torch.no_grad():\n            output = self.network(features)\n\n        return output[\'policy\'][0].numpy(), output[\'value\'][0].item()\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\uace0\uae09-\uae30\uc220",children:"\uace0\uae09 \uae30\uc220"}),"\n",(0,i.jsx)(n.h3,{id:"dirichlet-\ub178\uc774\uc988",children:"Dirichlet \ub178\uc774\uc988"}),"\n",(0,i.jsx)(n.p,{children:"\ud559\uc2b5 \uc2dc \ub8e8\ud2b8 \ub178\ub4dc\uc5d0 \ub178\uc774\uc988\ub97c \ucd94\uac00\ud558\uc5ec \ud0d0\uc0c9 \uc99d\uac00:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def add_dirichlet_noise(root, alpha=0.03, epsilon=0.25):\n    """\ub8e8\ud2b8 \ub178\ub4dc\uc5d0 Dirichlet \ub178\uc774\uc988 \ucd94\uac00"""\n    noise = np.random.dirichlet([alpha] * len(root.children))\n\n    for i, child in enumerate(root.children.values()):\n        child.prior = (1 - epsilon) * child.prior + epsilon * noise[i]\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\uc628\ub3c4-\ud30c\ub77c\ubbf8\ud130",children:"\uc628\ub3c4 \ud30c\ub77c\ubbf8\ud130"}),"\n",(0,i.jsx)(n.p,{children:"\ucc29\uc218 \uc120\ud0dd\uc758 \ubb34\uc791\uc704\uc131 \uc81c\uc5b4:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def select_action_with_temperature(root, temperature=1.0):\n    """\ubc29\ubb38 \ud69f\uc218\uc640 \uc628\ub3c4\uc5d0 \ub530\ub77c \ucc29\uc218 \uc120\ud0dd"""\n    visits = np.array([c.visit_count for c in root.children.values()])\n    actions = list(root.children.keys())\n\n    if temperature == 0:\n        # \ud0d0\uc695\uc801 \uc120\ud0dd\n        return actions[np.argmax(visits)]\n    else:\n        # \ubc29\ubb38 \ud69f\uc218\uc758 \ud655\ub960 \ubd84\ud3ec\uc5d0 \ub530\ub77c \uc120\ud0dd\n        probs = visits ** (1 / temperature)\n        probs = probs / probs.sum()\n        return np.random.choice(actions, p=probs)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\ud2b8\ub9ac-\uc7ac\uc0ac\uc6a9",children:"\ud2b8\ub9ac \uc7ac\uc0ac\uc6a9"}),"\n",(0,i.jsx)(n.p,{children:"\uc0c8\ub85c\uc6b4 \uc218\uc5d0\uc11c \uc774\uc804 \ud0d0\uc0c9 \ud2b8\ub9ac \uc7ac\uc0ac\uc6a9:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def reuse_tree(root, action):\n    """\uc11c\ube0c\ud2b8\ub9ac \uc7ac\uc0ac\uc6a9"""\n    if action in root.children:\n        new_root = root.children[action]\n        new_root.parent = None\n        return new_root\n    else:\n        return None  # \uc0c8 \ud2b8\ub9ac \uc0dd\uc131 \ud544\uc694\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\uc131\ub2a5-\ucd5c\uc801\ud654-\uc694\uc57d",children:"\uc131\ub2a5 \ucd5c\uc801\ud654 \uc694\uc57d"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\uae30\uc220"}),(0,i.jsx)(n.th,{children:"\ud6a8\uacfc"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"\ubc30\uce58 \ud3c9\uac00"})}),(0,i.jsx)(n.td,{children:"GPU \ud65c\uc6a9\ub960 10% \u2192 80%+"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"\uac00\uc0c1 \uc190\uc2e4"})}),(0,i.jsx)(n.td,{children:"\uba40\ud2f0\uc2a4\ub808\ub4dc \ud6a8\uc728 3-5\ubc30 \ud5a5\uc0c1"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"\ud2b8\ub9ac \uc7ac\uc0ac\uc6a9"})}),(0,i.jsx)(n.td,{children:"\ucf5c\ub4dc \uc2a4\ud0c0\ud2b8 \uac10\uc18c, 30%+ \uacc4\uc0b0 \uc808\uc57d"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"\uba54\ubaa8\ub9ac \ud480"})}),(0,i.jsx)(n.td,{children:"\uba54\ubaa8\ub9ac \ud560\ub2f9 \uc624\ubc84\ud5e4\ub4dc \uac10\uc18c"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ucd94\uac00-\uc77d\uae30",children:"\ucd94\uac00 \uc77d\uae30"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../neural-network",children:"\uc2e0\uacbd\ub9dd \uc544\ud0a4\ud14d\ucc98 \uc0c1\uc138 \ubd84\uc11d"})," \u2014 \ud3c9\uac00 \ud568\uc218\uc758 \ucd9c\ucc98"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../gpu-optimization",children:"GPU \ubc31\uc5d4\ub4dc\uc640 \ucd5c\uc801\ud654"})," \u2014 \ubc30\uce58 \ucd94\ub860\uc758 \ud558\ub4dc\uc6e8\uc5b4 \ucd5c\uc801\ud654"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../papers",children:"\ud575\uc2ec \ub17c\ubb38 \uac00\uc774\ub4dc"})," \u2014 PUCT \uacf5\uc2dd\uc758 \uc774\ub860\uc801 \uae30\ucd08"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},30416(e,n,s){s.d(n,{R:()=>r,x:()=>a});var l=s(59471);const i={},t=l.createContext(i);function r(e){const n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);