"use strict";(globalThis.webpackChunktemp_docusaurus=globalThis.webpackChunktemp_docusaurus||[]).push([[1370],{69451(n,e,s){s.r(e),s.d(e,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"tech/deep-dive/training","title":"KataGo \u8bad\u7ec3\u673a\u5236\u89e3\u6790","description":"\u6df1\u5165\u7406\u89e3 KataGo \u7684\u81ea\u6211\u5bf9\u5f08\u8bad\u7ec3\u6d41\u7a0b\u4e0e\u6838\u5fc3\u6280\u672f","source":"@site/i18n/zh-cn/docusaurus-plugin-content-docs/current/tech/deep-dive/training.md","sourceDirName":"tech/deep-dive","slug":"/tech/deep-dive/training","permalink":"/zh-cn/docs/tech/deep-dive/training","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tech/deep-dive/training.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"KataGo \u8bad\u7ec3\u673a\u5236\u89e3\u6790","description":"\u6df1\u5165\u7406\u89e3 KataGo \u7684\u81ea\u6211\u5bf9\u5f08\u8bad\u7ec3\u6d41\u7a0b\u4e0e\u6838\u5fc3\u6280\u672f"},"sidebar":"tutorialSidebar","previous":{"title":"KataGo \u6e90\u4ee3\u7801\u5bfc\u8bfb","permalink":"/zh-cn/docs/tech/deep-dive/source-code"},"next":{"title":"\u53c2\u4e0e\u5f00\u6e90\u793e\u533a","permalink":"/zh-cn/docs/tech/deep-dive/contributing"}}');var r=s(62615),i=s(30416);const d={sidebar_position:3,title:"KataGo \u8bad\u7ec3\u673a\u5236\u89e3\u6790",description:"\u6df1\u5165\u7406\u89e3 KataGo \u7684\u81ea\u6211\u5bf9\u5f08\u8bad\u7ec3\u6d41\u7a0b\u4e0e\u6838\u5fc3\u6280\u672f"},t="KataGo \u8bad\u7ec3\u673a\u5236\u89e3\u6790",a={},c=[{value:"\u8bad\u7ec3\u6982\u8ff0",id:"\u8bad\u7ec3\u6982\u8ff0",level:2},{value:"\u8bad\u7ec3\u5faa\u73af",id:"\u8bad\u7ec3\u5faa\u73af",level:3},{value:"\u786c\u4ef6\u9700\u6c42",id:"\u786c\u4ef6\u9700\u6c42",level:3},{value:"\u73af\u5883\u8bbe\u7f6e",id:"\u73af\u5883\u8bbe\u7f6e",level:2},{value:"\u5b89\u88c5\u4f9d\u8d56",id:"\u5b89\u88c5\u4f9d\u8d56",level:3},{value:"\u83b7\u53d6\u8bad\u7ec3\u4ee3\u7801",id:"\u83b7\u53d6\u8bad\u7ec3\u4ee3\u7801",level:3},{value:"\u8bad\u7ec3\u914d\u7f6e",id:"\u8bad\u7ec3\u914d\u7f6e",level:2},{value:"\u914d\u7f6e\u6587\u4ef6\u7ed3\u6784",id:"\u914d\u7f6e\u6587\u4ef6\u7ed3\u6784",level:3},{value:"\u6a21\u578b\u89c4\u6a21\u5bf9\u7167",id:"\u6a21\u578b\u89c4\u6a21\u5bf9\u7167",level:3},{value:"\u8bad\u7ec3\u6d41\u7a0b",id:"\u8bad\u7ec3\u6d41\u7a0b",level:2},{value:"\u6b65\u9aa4 1\uff1a\u521d\u59cb\u5316\u6a21\u578b",id:"\u6b65\u9aa4-1\u521d\u59cb\u5316\u6a21\u578b",level:3},{value:"\u6b65\u9aa4 2\uff1a\u81ea\u6211\u5bf9\u5f08\u4ea7\u751f\u6570\u636e",id:"\u6b65\u9aa4-2\u81ea\u6211\u5bf9\u5f08\u4ea7\u751f\u6570\u636e",level:3},{value:"\u6b65\u9aa4 3\uff1a\u8bad\u7ec3\u795e\u7ecf\u7f51\u7edc",id:"\u6b65\u9aa4-3\u8bad\u7ec3\u795e\u7ecf\u7f51\u7edc",level:3},{value:"\u6b65\u9aa4 4\uff1a\u8bc4\u4f30\u4e0e\u8fed\u4ee3",id:"\u6b65\u9aa4-4\u8bc4\u4f30\u4e0e\u8fed\u4ee3",level:3},{value:"\u635f\u5931\u51fd\u6570\u8be6\u89e3",id:"\u635f\u5931\u51fd\u6570\u8be6\u89e3",level:2},{value:"Policy Loss",id:"policy-loss",level:3},{value:"Value Loss",id:"value-loss",level:3},{value:"Ownership Loss",id:"ownership-loss",level:3},{value:"\u8fdb\u9636\u6280\u5de7",id:"\u8fdb\u9636\u6280\u5de7",level:2},{value:"1. \u6570\u636e\u589e\u5f3a",id:"1-\u6570\u636e\u589e\u5f3a",level:3},{value:"2. \u8bfe\u7a0b\u5b66\u4e60",id:"2-\u8bfe\u7a0b\u5b66\u4e60",level:3},{value:"3. \u6df7\u5408\u7cbe\u5ea6\u8bad\u7ec3",id:"3-\u6df7\u5408\u7cbe\u5ea6\u8bad\u7ec3",level:3},{value:"4. \u591a GPU \u8bad\u7ec3",id:"4-\u591a-gpu-\u8bad\u7ec3",level:3},{value:"\u76d1\u63a7\u4e0e\u8c03\u8bd5",id:"\u76d1\u63a7\u4e0e\u8c03\u8bd5",level:2},{value:"TensorBoard \u76d1\u63a7",id:"tensorboard-\u76d1\u63a7",level:3},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:3},{value:"\u5c0f\u89c4\u6a21\u5b9e\u9a8c\u5efa\u8bae",id:"\u5c0f\u89c4\u6a21\u5b9e\u9a8c\u5efa\u8bae",level:2},{value:"\u5ef6\u4f38\u9605\u8bfb",id:"\u5ef6\u4f38\u9605\u8bfb",level:2}];function o(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"katago-\u8bad\u7ec3\u673a\u5236\u89e3\u6790",children:"KataGo \u8bad\u7ec3\u673a\u5236\u89e3\u6790"})}),"\n",(0,r.jsx)(e.p,{children:"\u672c\u6587\u6df1\u5165\u89e3\u6790 KataGo \u7684\u8bad\u7ec3\u673a\u5236\uff0c\u5e2e\u52a9\u4f60\u7406\u89e3\u81ea\u6211\u5bf9\u5f08\u8bad\u7ec3\u7684\u8fd0\u4f5c\u539f\u7406\u3002"}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u8bad\u7ec3\u6982\u8ff0",children:"\u8bad\u7ec3\u6982\u8ff0"}),"\n",(0,r.jsx)(e.h3,{id:"\u8bad\u7ec3\u5faa\u73af",children:"\u8bad\u7ec3\u5faa\u73af"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"\u521d\u59cb\u6a21\u578b \u2192 \u81ea\u6211\u5bf9\u5f08 \u2192 \u6536\u96c6\u6570\u636e \u2192 \u8bad\u7ec3\u66f4\u65b0 \u2192 \u66f4\u5f3a\u6a21\u578b \u2192 \u91cd\u590d\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52a8\u753b\u5bf9\u5e94"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"E5 \u81ea\u6211\u5bf9\u5f08 \u2194 \u4e0d\u52a8\u70b9\u6536\u655b"}),"\n",(0,r.jsx)(e.li,{children:"E6 \u68cb\u529b\u66f2\u7ebf \u2194 S \u66f2\u7ebf\u6210\u957f"}),"\n",(0,r.jsx)(e.li,{children:"H1 MDP \u2194 \u9a6c\u5c14\u53ef\u592b\u94fe"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u786c\u4ef6\u9700\u6c42",children:"\u786c\u4ef6\u9700\u6c42"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u6a21\u578b\u89c4\u6a21"}),(0,r.jsx)(e.th,{children:"GPU \u663e\u5b58"}),(0,r.jsx)(e.th,{children:"\u8bad\u7ec3\u65f6\u95f4"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b6c96"}),(0,r.jsx)(e.td,{children:"4 GB"}),(0,r.jsx)(e.td,{children:"\u6570\u5c0f\u65f6"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b10c128"}),(0,r.jsx)(e.td,{children:"8 GB"}),(0,r.jsx)(e.td,{children:"1-2 \u5929"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b18c384"}),(0,r.jsx)(e.td,{children:"16 GB"}),(0,r.jsx)(e.td,{children:"1-2 \u5468"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b40c256"}),(0,r.jsx)(e.td,{children:"24 GB+"}),(0,r.jsx)(e.td,{children:"\u6570\u5468"})]})]})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u73af\u5883\u8bbe\u7f6e",children:"\u73af\u5883\u8bbe\u7f6e"}),"\n",(0,r.jsx)(e.h3,{id:"\u5b89\u88c5\u4f9d\u8d56",children:"\u5b89\u88c5\u4f9d\u8d56"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# Python \u73af\u5883\nconda create -n katago python=3.10\nconda activate katago\n\n# PyTorch\uff08CUDA \u7248\u672c\uff09\npip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118\n\n# \u5176\u4ed6\u4f9d\u8d56\npip install numpy h5py tqdm tensorboard\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u83b7\u53d6\u8bad\u7ec3\u4ee3\u7801",children:"\u83b7\u53d6\u8bad\u7ec3\u4ee3\u7801"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"git clone https://github.com/lightvector/KataGo.git\ncd KataGo/python\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u8bad\u7ec3\u914d\u7f6e",children:"\u8bad\u7ec3\u914d\u7f6e"}),"\n",(0,r.jsx)(e.h3,{id:"\u914d\u7f6e\u6587\u4ef6\u7ed3\u6784",children:"\u914d\u7f6e\u6587\u4ef6\u7ed3\u6784"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'# configs/train_config.yaml\n\n# \u6a21\u578b\u67b6\u6784\nmodel:\n  num_blocks: 10          # \u6b8b\u5dee\u5757\u6570\u91cf\n  trunk_channels: 128     # \u4e3b\u5e72\u901a\u9053\u6570\n  policy_channels: 32     # Policy \u5934\u901a\u9053\u6570\n  value_channels: 32      # Value \u5934\u901a\u9053\u6570\n\n# \u8bad\u7ec3\u53c2\u6570\ntraining:\n  batch_size: 256\n  learning_rate: 0.001\n  lr_schedule: "cosine"\n  weight_decay: 0.0001\n  epochs: 100\n\n# \u81ea\u6211\u5bf9\u5f08\u53c2\u6570\nselfplay:\n  num_games_per_iteration: 1000\n  max_visits: 600\n  temperature: 1.0\n  temperature_drop_move: 20\n\n# \u6570\u636e\u914d\u7f6e\ndata:\n  max_history_games: 500000\n  shuffle_buffer_size: 100000\n'})}),"\n",(0,r.jsx)(e.h3,{id:"\u6a21\u578b\u89c4\u6a21\u5bf9\u7167",children:"\u6a21\u578b\u89c4\u6a21\u5bf9\u7167"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u540d\u79f0"}),(0,r.jsx)(e.th,{children:"num_blocks"}),(0,r.jsx)(e.th,{children:"trunk_channels"}),(0,r.jsx)(e.th,{children:"\u53c2\u6570\u91cf"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b6c96"}),(0,r.jsx)(e.td,{children:"6"}),(0,r.jsx)(e.td,{children:"96"}),(0,r.jsx)(e.td,{children:"~1M"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b10c128"}),(0,r.jsx)(e.td,{children:"10"}),(0,r.jsx)(e.td,{children:"128"}),(0,r.jsx)(e.td,{children:"~3M"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b18c384"}),(0,r.jsx)(e.td,{children:"18"}),(0,r.jsx)(e.td,{children:"384"}),(0,r.jsx)(e.td,{children:"~20M"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"b40c256"}),(0,r.jsx)(e.td,{children:"40"}),(0,r.jsx)(e.td,{children:"256"}),(0,r.jsx)(e.td,{children:"~45M"})]})]})]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52a8\u753b\u5bf9\u5e94"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"F2 \u7f51\u7edc\u5927\u5c0f vs \u68cb\u529b\uff1a\u5bb9\u91cf\u7f29\u653e"}),"\n",(0,r.jsx)(e.li,{children:"F6 \u795e\u7ecf\u7f29\u653e\u5f8b\uff1a\u53cc\u5bf9\u6570\u5173\u7cfb"}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u8bad\u7ec3\u6d41\u7a0b",children:"\u8bad\u7ec3\u6d41\u7a0b"}),"\n",(0,r.jsx)(e.h3,{id:"\u6b65\u9aa4-1\u521d\u59cb\u5316\u6a21\u578b",children:"\u6b65\u9aa4 1\uff1a\u521d\u59cb\u5316\u6a21\u578b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# init_model.py\nimport torch\nfrom model import KataGoModel\n\nconfig = {\n    'num_blocks': 10,\n    'trunk_channels': 128,\n    'input_features': 22,\n    'policy_size': 362,  # 361 + pass\n}\n\nmodel = KataGoModel(config)\ntorch.save(model.state_dict(), 'model_init.pt')\nprint(f\"\u6a21\u578b\u53c2\u6570\u91cf: {sum(p.numel() for p in model.parameters()):,}\")\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u6b65\u9aa4-2\u81ea\u6211\u5bf9\u5f08\u4ea7\u751f\u6570\u636e",children:"\u6b65\u9aa4 2\uff1a\u81ea\u6211\u5bf9\u5f08\u4ea7\u751f\u6570\u636e"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u7f16\u8bd1 C++ \u5f15\u64ce\ncd ../cpp\nmkdir build && cd build\ncmake .. -DUSE_BACKEND=CUDA\nmake -j$(nproc)\n\n# \u6267\u884c\u81ea\u6211\u5bf9\u5f08\n./katago selfplay \\\n  -model ../python/model_init.pt \\\n  -output-dir ../python/selfplay_data \\\n  -config selfplay.cfg \\\n  -num-games 1000\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u81ea\u6211\u5bf9\u5f08\u914d\u7f6e\uff08selfplay.cfg\uff09\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-ini",children:"maxVisits = 600\nnumSearchThreads = 4\n\n# \u6e29\u5ea6\u914d\u7f6e\uff08\u589e\u52a0\u63a2\u7d22\uff09\nchosenMoveTemperature = 1.0\nchosenMoveTemperatureEarly = 1.0\nchosenMoveTemperatureHalflife = 20\n\n# Dirichlet \u566a\u58f0\uff08\u589e\u52a0\u591a\u6837\u6027\uff09\nrootNoiseEnabled = true\nrootDirichletNoiseTotalConcentration = 10.83\nrootDirichletNoiseWeight = 0.25\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52a8\u753b\u5bf9\u5e94"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"C3 \u63a2\u7d22 vs \u5229\u7528\uff1a\u6e29\u5ea6\u53c2\u6570"}),"\n",(0,r.jsx)(e.li,{children:"E10 Dirichlet \u566a\u58f0\uff1a\u6839\u8282\u70b9\u63a2\u7d22"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u6b65\u9aa4-3\u8bad\u7ec3\u795e\u7ecf\u7f51\u7edc",children:"\u6b65\u9aa4 3\uff1a\u8bad\u7ec3\u795e\u7ecf\u7f51\u7edc"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# train.py\nimport torch\nfrom torch.utils.data import DataLoader\nfrom model import KataGoModel\nfrom dataset import SelfPlayDataset\n\n# \u52a0\u8f7d\u6570\u636e\ndataset = SelfPlayDataset('selfplay_data/')\ndataloader = DataLoader(dataset, batch_size=256, shuffle=True)\n\n# \u52a0\u8f7d\u6a21\u578b\nmodel = KataGoModel(config)\nmodel.load_state_dict(torch.load('model_init.pt'))\nmodel = model.cuda()\n\n# \u4f18\u5316\u5668\noptimizer = torch.optim.Adam(\n    model.parameters(),\n    lr=0.001,\n    weight_decay=0.0001\n)\n\n# \u5b66\u4e60\u7387\u8c03\u5ea6\nscheduler = torch.optim.lr_scheduler.CosineAnnealingLR(\n    optimizer,\n    T_max=100,\n    eta_min=0.00001\n)\n\n# \u8bad\u7ec3\u5faa\u73af\nfor epoch in range(100):\n    model.train()\n    total_loss = 0\n\n    for batch in dataloader:\n        inputs = batch['inputs'].cuda()\n        policy_target = batch['policy'].cuda()\n        value_target = batch['value'].cuda()\n        ownership_target = batch['ownership'].cuda()\n\n        # \u524d\u5411\u4f20\u64ad\n        policy_pred, value_pred, ownership_pred = model(inputs)\n\n        # \u8ba1\u7b97\u635f\u5931\n        policy_loss = torch.nn.functional.cross_entropy(\n            policy_pred, policy_target\n        )\n        value_loss = torch.nn.functional.mse_loss(\n            value_pred, value_target\n        )\n        ownership_loss = torch.nn.functional.mse_loss(\n            ownership_pred, ownership_target\n        )\n\n        loss = policy_loss + value_loss + 0.5 * ownership_loss\n\n        # \u53cd\u5411\u4f20\u64ad\n        optimizer.zero_grad()\n        loss.backward()\n        torch.nn.utils.clip_grad_norm_(model.parameters(), 1.0)\n        optimizer.step()\n\n        total_loss += loss.item()\n\n    scheduler.step()\n    print(f\"Epoch {epoch}: Loss = {total_loss / len(dataloader):.4f}\")\n\n    # \u4fdd\u5b58\u68c0\u67e5\u70b9\n    torch.save(model.state_dict(), f'model_epoch{epoch}.pt')\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52a8\u753b\u5bf9\u5e94"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"D5 \u68af\u5ea6\u4e0b\u964d\uff1aoptimizer.step()"}),"\n",(0,r.jsx)(e.li,{children:"K2 \u52a8\u91cf\uff1aAdam \u4f18\u5316\u5668"}),"\n",(0,r.jsx)(e.li,{children:"K4 \u5b66\u4e60\u7387\u8870\u51cf\uff1aCosineAnnealingLR"}),"\n",(0,r.jsx)(e.li,{children:"K5 \u68af\u5ea6\u88c1\u526a\uff1aclip_grad_norm_"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u6b65\u9aa4-4\u8bc4\u4f30\u4e0e\u8fed\u4ee3",children:"\u6b65\u9aa4 4\uff1a\u8bc4\u4f30\u4e0e\u8fed\u4ee3"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u8bc4\u4f30\u65b0\u6a21\u578b vs \u65e7\u6a21\u578b\n./katago match \\\n  -model1 model_epoch99.pt \\\n  -model2 model_init.pt \\\n  -num-games 100 \\\n  -output match_results.txt\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679c\u65b0\u6a21\u578b\u80dc\u7387 > 55%\uff0c\u5219\u66ff\u6362\u65e7\u6a21\u578b\uff0c\u8fdb\u5165\u4e0b\u4e00\u8f6e\u8fed\u4ee3\u3002"}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u635f\u5931\u51fd\u6570\u8be6\u89e3",children:"\u635f\u5931\u51fd\u6570\u8be6\u89e3"}),"\n",(0,r.jsx)(e.h3,{id:"policy-loss",children:"Policy Loss"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# \u4ea4\u53c9\u71b5\u635f\u5931\npolicy_loss = -sum(target * log(pred))\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u76ee\u6807\uff1a\u8ba9\u9884\u6d4b\u7684\u6982\u7387\u5206\u5e03\u63a5\u8fd1 MCTS \u641c\u7d22\u7ed3\u679c\u3002"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52a8\u753b\u5bf9\u5e94"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"J1 \u7b56\u7565\u71b5\uff1a\u4ea4\u53c9\u71b5"}),"\n",(0,r.jsx)(e.li,{children:"J2 KL \u6563\u5ea6\uff1a\u5206\u5e03\u8ddd\u79bb"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"value-loss",children:"Value Loss"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# \u5747\u65b9\u8bef\u5dee\nvalue_loss = (pred - actual_result)^2\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u76ee\u6807\uff1a\u9884\u6d4b\u5bf9\u5c40\u6700\u7ec8\u7ed3\u679c\uff08\u80dc/\u8d1f/\u548c\uff09\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"ownership-loss",children:"Ownership Loss"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# \u6bcf\u70b9\u5f52\u5c5e\u9884\u6d4b\nownership_loss = mean((pred - actual_ownership)^2)\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u76ee\u6807\uff1a\u9884\u6d4b\u6bcf\u4e2a\u4f4d\u7f6e\u6700\u7ec8\u5f52\u5c5e\u3002"}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u8fdb\u9636\u6280\u5de7",children:"\u8fdb\u9636\u6280\u5de7"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u6570\u636e\u589e\u5f3a",children:"1. \u6570\u636e\u589e\u5f3a"}),"\n",(0,r.jsx)(e.p,{children:"\u5229\u7528\u68cb\u76d8\u7684\u5bf9\u79f0\u6027\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'def augment_data(board, policy, ownership):\n    """\u5bf9 D4 \u7fa4\u7684 8 \u79cd\u53d8\u6362\u8fdb\u884c\u6570\u636e\u589e\u5f3a"""\n    augmented = []\n\n    for rotation in range(4):\n        for flip in [False, True]:\n            # \u65cb\u8f6c\u4e0e\u7ffb\u8f6c\n            aug_board = transform(board, rotation, flip)\n            aug_policy = transform(policy, rotation, flip)\n            aug_ownership = transform(ownership, rotation, flip)\n            augmented.append((aug_board, aug_policy, aug_ownership))\n\n    return augmented\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52a8\u753b\u5bf9\u5e94"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"A9 \u68cb\u76d8\u5bf9\u79f0\u6027\uff1aD4 \u7fa4"}),"\n",(0,r.jsx)(e.li,{children:"L4 \u6570\u636e\u589e\u5f3a\uff1a\u5bf9\u79f0\u6027\u5229\u7528"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"2-\u8bfe\u7a0b\u5b66\u4e60",children:"2. \u8bfe\u7a0b\u5b66\u4e60"}),"\n",(0,r.jsx)(e.p,{children:"\u4ece\u7b80\u5355\u5230\u590d\u6742\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"# \u5148\u7528\u8f83\u5c11\u641c\u7d22\u6b21\u6570\u8bad\u7ec3\nschedule = [\n    (100, 10000),   # 100 visits, 10000 games\n    (200, 20000),   # 200 visits, 20000 games\n    (400, 50000),   # 400 visits, 50000 games\n    (600, 100000),  # 600 visits, 100000 games\n]\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52a8\u753b\u5bf9\u5e94"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"E12 \u8bad\u7ec3\u8bfe\u7a0b\uff1a\u8bfe\u7a0b\u5b66\u4e60"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"3-\u6df7\u5408\u7cbe\u5ea6\u8bad\u7ec3",children:"3. \u6df7\u5408\u7cbe\u5ea6\u8bad\u7ec3"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"from torch.cuda.amp import autocast, GradScaler\n\nscaler = GradScaler()\n\nwith autocast():\n    policy_pred, value_pred, ownership_pred = model(inputs)\n    loss = compute_loss(...)\n\nscaler.scale(loss).backward()\nscaler.step(optimizer)\nscaler.update()\n"})}),"\n",(0,r.jsx)(e.h3,{id:"4-\u591a-gpu-\u8bad\u7ec3",children:"4. \u591a GPU \u8bad\u7ec3"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"import torch.distributed as dist\nfrom torch.nn.parallel import DistributedDataParallel\n\n# \u521d\u59cb\u5316\u5206\u5e03\u5f0f\ndist.init_process_group(backend='nccl')\n\n# \u5305\u88c5\u6a21\u578b\nmodel = DistributedDataParallel(model)\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u76d1\u63a7\u4e0e\u8c03\u8bd5",children:"\u76d1\u63a7\u4e0e\u8c03\u8bd5"}),"\n",(0,r.jsx)(e.h3,{id:"tensorboard-\u76d1\u63a7",children:"TensorBoard \u76d1\u63a7"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"from torch.utils.tensorboard import SummaryWriter\n\nwriter = SummaryWriter('runs/training')\n\n# \u8bb0\u5f55\u635f\u5931\nwriter.add_scalar('Loss/policy', policy_loss, step)\nwriter.add_scalar('Loss/value', value_loss, step)\nwriter.add_scalar('Loss/total', total_loss, step)\n\n# \u8bb0\u5f55\u5b66\u4e60\u7387\nwriter.add_scalar('LR', scheduler.get_last_lr()[0], step)\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"tensorboard --logdir runs\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u95ee\u9898"}),(0,r.jsx)(e.th,{children:"\u53ef\u80fd\u539f\u56e0"}),(0,r.jsx)(e.th,{children:"\u89e3\u51b3\u65b9\u6848"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u635f\u5931\u4e0d\u4e0b\u964d"}),(0,r.jsx)(e.td,{children:"\u5b66\u4e60\u7387\u592a\u4f4e/\u592a\u9ad8"}),(0,r.jsx)(e.td,{children:"\u8c03\u6574\u5b66\u4e60\u7387"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u635f\u5931\u9707\u8361"}),(0,r.jsx)(e.td,{children:"\u6279\u91cf\u5927\u5c0f\u592a\u5c0f"}),(0,r.jsx)(e.td,{children:"\u589e\u52a0\u6279\u91cf\u5927\u5c0f"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fc7\u62df\u5408"}),(0,r.jsx)(e.td,{children:"\u6570\u636e\u4e0d\u8db3"}),(0,r.jsx)(e.td,{children:"\u4ea7\u751f\u66f4\u591a\u81ea\u6211\u5bf9\u5f08\u6570\u636e"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u68cb\u529b\u4e0d\u589e\u957f"}),(0,r.jsx)(e.td,{children:"\u641c\u7d22\u6b21\u6570\u592a\u5c11"}),(0,r.jsx)(e.td,{children:"\u589e\u52a0 maxVisits"})]})]})]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"\u52a8\u753b\u5bf9\u5e94"}),"\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"L1 \u8fc7\u62df\u5408\uff1a\u8fc7\u5ea6\u9002\u5e94"}),"\n",(0,r.jsx)(e.li,{children:"L2 \u6b63\u5219\u5316\uff1aweight_decay"}),"\n",(0,r.jsx)(e.li,{children:"D6 \u5b66\u4e60\u7387\u6548\u5e94\uff1a\u8c03\u53c2"}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u5c0f\u89c4\u6a21\u5b9e\u9a8c\u5efa\u8bae",children:"\u5c0f\u89c4\u6a21\u5b9e\u9a8c\u5efa\u8bae"}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679c\u4f60\u53ea\u662f\u60f3\u5b9e\u9a8c\uff0c\u5efa\u8bae\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4f7f\u7528 9\xd79 \u68cb\u76d8"}),"\uff1a\u5927\u5e45\u51cf\u5c11\u8ba1\u7b97\u91cf"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4f7f\u7528\u5c0f\u578b\u6a21\u578b"}),"\uff1ab6c96 \u8db3\u591f\u5b9e\u9a8c"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u51cf\u5c11\u641c\u7d22\u6b21\u6570"}),"\uff1a100-200 visits"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4f7f\u7528\u9884\u8bad\u7ec3\u6a21\u578b\u5fae\u8c03"}),"\uff1a\u6bd4\u4ece\u96f6\u5f00\u59cb\u5feb"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# 9\xd79 \u68cb\u76d8\u914d\u7f6e\nboardSize = 9\nmaxVisits = 100\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"\u5ef6\u4f38\u9605\u8bfb",children:"\u5ef6\u4f38\u9605\u8bfb"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"../source-code",children:"\u6e90\u4ee3\u7801\u5bfc\u8bfb"})," \u2014 \u7406\u89e3\u4ee3\u7801\u7ed3\u6784"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"../contributing",children:"\u53c2\u4e0e\u5f00\u6e90\u793e\u533a"})," \u2014 \u52a0\u5165\u5206\u5e03\u5f0f\u8bad\u7ec3"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.a,{href:"../../how-it-works/katago-innovations",children:"KataGo \u7684\u5173\u952e\u521b\u65b0"})," \u2014 50 \u500d\u6548\u7387\u7684\u79d8\u5bc6"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(o,{...n})}):o(n)}},30416(n,e,s){s.d(e,{R:()=>d,x:()=>t});var l=s(59471);const r={},i=l.createContext(r);function d(n){const e=l.useContext(i);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:d(n.components),l.createElement(i.Provider,{value:e},n.children)}}}]);